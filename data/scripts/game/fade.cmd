IF NOT DEFINED VERCODE EXIT
SET DIED_NOW=FALSE
SETLOCAL ENABLEDELAYEDEXPANSION
FOR /L %%I IN (1,1,!EN.MAX!) DO (
	IF !ENEMY.HP.NOW.%%I! LEQ 0 (
		ENDLOCAL
		CALL :CREATE_FRAMES %%I
		SETLOCAL ENABLEDELAYEDEXPANSION
	)
)
ENDLOCAL
EXIT /B 0

:CREATE_FRAMES
SETLOCAL ENABLEDELAYEDEXPANSION
IF NOT "!FRAME.FADE.%1!."=="==========." (
	ENDLOCAL
	IF NOT "%FADE%."=="----------." (
		SET "FADE=%FADE%-"
		CALL :FIX_FRAME %1 %%FADE%%
		CALL "%SCRIPTS_GAME%\enemy_display.cmd"
		SET DIED_NOW=TRUE
		GOTO CREATE_FRAMES
	)
)
IF !DIED_NOW!==TRUE (
	ENDLOCAL
	CALL :LOGIT %%I
) ELSE ENDLOCAL
SET FADE=
EXIT /B 0

:FIX_FRAME
SET ARG=%2
SET FRAME.FADE.%1=%ARG:-==%
SET FADE=%2
EXIT /B 0

:LOGIT
SETLOCAL ENABLEDELAYEDEXPANSION
SET TMP.ENEMY=!ENEMY.TYPE.%1!
ENDLOCAL&CALL "%SCRIPTS_GAME%\logger.cmd" ADD Enemy [4m%TMP.ENEMY%[24m ^(#%1^) has %RGB.RED%died[0m[1m!%RGB.YELLOW%[0m

:: And progress the player's quest
CALL "%QUESTS%" ADD TOTAL_MONSTERS 1

EXIT /B 0
