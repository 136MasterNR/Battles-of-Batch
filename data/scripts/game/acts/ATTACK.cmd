IF NOT DEFINED VERCODE EXIT
:REROLL
ENDLOCAL
SET INPUTATK=
SET ISNUM=
SET PLAYER.ATTACK.AMOUNT=
SET PLAYER.ATTACK.ENEMY.R=
SET ATK.CRIT=
SET CRIT.CHANCE=
SET ENEMY.IS.HP=
::SET /A CRIT.CHANCE=10 - %SKILL.CRIT_RATE%
SET /A "CRIT.RATE=%SKILL.CRIT_RATE%*5"
SET /A "CRIT.CHANCE=%random% %% 100"
SET /A "PLAYER.ATTACK.CNT1=(50*%SKILL.ATK%)/2"
SET /A "PLAYER.ATTACK.AMOUNT=%random% %% %PLAYER.ATTACK.CNT1% +%PLAYER.ATTACK.CNT1%"
IF %CRIT.CHANCE% GTR %CRIT.RATE% ( SET ATK.CRIT=0 ) ELSE ( SET /A ATK.CRIT=PLAYER.ATTACK.AMOUNT*3&SET /A ATK.CRIT=ATK.CRIT/4&SET /A PLAYER.ATTACK.AMOUNT+=ATK.CRIT )
ECHO.[15A
IF "%SHORTCUTS.VALUE%"=="TRUE" (
	SET A_1=
	SET A_2=
	SET B_1=
	SET B_2=
	SET C_1=
	SET C_2=
	IF NOT %ENEMY.HP.NOW.2%==0 SET "A_1=IF %ENEMY.HP.FULL.1% LSS %ENEMY.HP.FULL.2% "
	IF NOT %ENEMY.HP.NOW.3%==0 SET "A_2=IF %ENEMY.HP.FULL.1% LSS %ENEMY.HP.FULL.3% "
	IF NOT %ENEMY.HP.NOW.1%==0 SET "B_1=IF %ENEMY.HP.FULL.2% LSS %ENEMY.HP.FULL.1% "
	IF NOT %ENEMY.HP.NOW.3%==0 SET "B_2=IF %ENEMY.HP.FULL.2% LSS %ENEMY.HP.FULL.3% "
	IF NOT %ENEMY.HP.NOW.1%==0 SET "C_1=IF %ENEMY.HP.FULL.3% LSS %ENEMY.HP.FULL.1% "
	IF NOT %ENEMY.HP.NOW.2%==0 SET "C_2=IF %ENEMY.HP.FULL.3% LSS %ENEMY.HP.FULL.2% "
)
IF "%SHORTCUTS.VALUE%"=="TRUE" (
	IF NOT %ENEMY.HP.NOW.1%==0 %A_1%%A_2%SET INPUTATK=1
	IF NOT %ENEMY.HP.NOW.2%==0 %B_1%%B_2%SET INPUTATK=2
	IF NOT %ENEMY.HP.NOW.3%==0 %C_1%%C_2%SET INPUTATK=3
) ELSE SET "INPUTATK=%UDERFINE:~4%"
::IF NOT %ENEMY.HP.NOW.1%==0 ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.2% IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.3% ( SET SET "INPUTATK=1" ) ELSE SET "INPUTATK=2" ) ELSE SET "INPUTATK=2"
::IF NOT %ENEMY.HP.NOW.2%==0 ( IF %ENEMY.HP.NOW.2% LSS %ENEMY.HP.NOW.3% IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.3% ( SET SET "INPUTATK=3" ) ) ELSE SET "INPUTATK=3"
::IF NOT %ENEMY.HP.NOW.1%==0 ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.2% ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.1% (
::	SET INPUTATK=1
::) ELSE IF %ENEMY.HP.NOW.2% LSS %ENEMY.HP.NOW.3% ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.2% (
::	SET INPUTATK=2
::) ELSE SET INPUTATK=3 ) ELSE SET INPUTATK=3 ) ELSE IF %ENEMY.HP.NOW.2% LSS %ENEMY.HP.NOW.3% ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.2% (
::	SET INPUTATK=2
::) ELSE SET INPUTATK=3 ) ELSE SET INPUTATK=3 ) ELSE IF %ENEMY.HP.NOW.2% LSS %ENEMY.HP.NOW.3% ( IF %ENEMY.HP.NOW.1% LSS %ENEMY.HP.NOW.2% (
::	SET INPUTATK=2
::) ELSE SET INPUTATK=3 ) ELSE SET INPUTATK=3
SET /A ISNUM=INPUTATK
IF DEFINED INPUTATK ( SET "PLAYER.ATTACK.ENEMY.R=%ISNUM%" ) ELSE SET /A "PLAYER.ATTACK.ENEMY.R=%random% %% 3 +1"
SET PLAYER.ATTACK.ENEMY=%PLAYER.ATTACK.ENEMY.R%
SET UDERFINE=ATK
SETLOCAL ENABLEDELAYEDEXPANSION
IF !ENEMY.HP.NOW.%PLAYER.ATTACK.ENEMY.R%! EQU 0 GOTO REROLL
ENDLOCAL
SET /A ENEMY.HP.NOW.%PLAYER.ATTACK.ENEMY.R%=ENEMY.HP.NOW.%PLAYER.ATTACK.ENEMY% -%PLAYER.ATTACK.AMOUNT%
SET /A ENEMY.IS.HP=ENEMY.HP.NOW.%PLAYER.ATTACK.ENEMY%
IF %ENEMY.IS.HP% LSS 0 ( SET ENEMY.HP.NOW.%PLAYER.ATTACK.ENEMY%=0)
SET PLAYER.ATTACK.AMOUNT.%PLAYER.ATTACK.ENEMY.R%=%PLAYER.ATTACK.AMOUNT%
SET "TARGETAEXT=.sfx"
SET /A SFX.RANDOM.CRIT=%random%%%3+1
SET /A SFX.RANDOM.ATK=%random%%%5+1
FOR /F "DELIMS=:" %%A IN ('TASKLIST /FI "WINDOWTITLE eq wscript.exe%TARGETAEXT%"') DO IF NOT %%A==INFO TASKKILL /F /FI "WINDOWTITLE eq wscript.exe%TARGETAEXT%" /T>NUL
IF NOT EXIST "%DATA_SETTINGS%\OFFSOUNDS.dll" IF %CRIT.CHANCE% EQU 0 (
	SETLOCAL ENABLEDELAYEDEXPANSION
	SET "TARGETAUDIO=%SFX.ATK.CRIT%%SFX.RANDOM.CRIT%.mp3"
	(
		ECHO Set Sound = CreateObject^("WMPlayer.OCX.7"^)
		ECHO Sound.URL = "!TARGETAUDIO!"
		ECHO Sound.Controls.play
		ECHO Sound.settings.volume = %VOLUME%
		ECHO Sound.settings.setMode "loop", False
		ECHO Sound.Controls.play
		ECHO While Sound.playState ^<^> 1
		ECHO      WScript.Sleep 100
		ECHO Wend
	) > "%DATA_TMP_A%"
	START /min "wscript.exe%TARGETAEXT%" cmd /c START /min /wait "" "%DATA_TMP_A%"^&DEL /Q "%DATA_TMP_A%"^&EXIT
) ELSE (
	SETLOCAL ENABLEDELAYEDEXPANSION
	SET "TARGETAUDIO=%SFX.ATK%%SFX.RANDOM.ATK%.mp3"
	IF EXIST "!TARGETAUDIO!" (
		(
			ECHO Set Sound = CreateObject^("WMPlayer.OCX.7"^)
			ECHO Sound.URL = "!TARGETAUDIO!"
			ECHO Sound.Controls.play
			ECHO Sound.settings.volume = %VOLUME%
			ECHO Sound.settings.setMode "loop", False
			ECHO Sound.Controls.play
			ECHO While Sound.playState ^<^> 1
			ECHO      WScript.Sleep 100
			ECHO Wend
		) > "%DATA_TMP_A%"
		START /min "wscript.exe%TARGETAEXT%" cmd /c START /min /wait "" "%DATA_TMP_A%"^&DEL /Q "%DATA_TMP_A%"^&EXIT
	)
)
ENDLOCAL
:END
GOTO :EOF