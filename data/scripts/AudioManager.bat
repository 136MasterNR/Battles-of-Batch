@ECHO OFF
CHCP 437>NUL
2>>".\data\logs\audManag\fatal.log" (SET "STARTED=1"&CALL :VAR)
@IF /I NOT DEFINED STARTED EXIT 1
:VAR
TITLE AudioManager
SET "DATA=.\data"
SET "DATA_TMP=%DATA%\temp"
SET "DATA_SCRIPTS=%DATA%\scripts"
SET "DATA_TMP_A=%DATA_TMP%\TMP_AUDIO.vbs"
CALL "%DATA_SCRIPTS%\versions.cmd"
SET "HTS_DATA=%APPDATA%\HTS_DATA"
SET "MAIN_GAME=%HTS_DATA%\BATTLESOFBATCH-%VERTYPE%-%VERCODE%"
SET "DATA_SAVES=%MAIN_GAME%\SAVES"
SET "DATA_SETTINGS=%MAIN_GAME%\SETTINGS"
SET "LOGS=%DATA%\logs\audManag"
SET "LOG_WSCRIPT=%LOGS%\wscript.log"
SET "LOG_INFO=%LOGS%\info.log"
SET "INFO=ECHO.INFO - "
IF NOT EXIST "%LOGS%" MD "%LOGS%"
IF EXIST "%LOG_WSCRIPT%" IF EXIST "%LOG_WSCRIPT.OLD%" ( DEL /Q "%LOG_WSCRIPT.OLD%" ) ELSE REN "%LOG_WSCRIPT%" "old.wscript.log"
IF EXIST "%LOG_INFO%" IF EXIST "%LOG_INFO.OLD%" ( DEL /Q "%LOG_INFO.OLD%" ) ELSE REN "%LOG_INFO%" "old.info.log"
%INFO%Log Started: %TIME% >"%LOG_WSCRIPT%"
%INFO%Log Started: %TIME% >"%LOG_INFO%"
:START
IF EXIST "%DATA_SETTINGS%\settings.cmd" CALL "%SETTINGS.LOAD%"
IF %AUDIO.VALUE%==FALSE GOTO END
IF EXIST "%APPDATA%\HTS_DATA\BATTLESOFBATCH-%GVER%\SETTINGS\OFFSOUNDS.dll" EXIT
TASKLIST /FI "IMAGENAME eq wscript.exe*" 2>NUL | FIND /I /N ":"
SET ERRORLEVEL.CACHE=%ERRORLEVEL%
MODE CON:COLS=58 LINES=6
IF /I "%ERRORLEVEL.CACHE%"=="1" ( ECHO.[1;30mINFO: Detected audio! ) ELSE ( ECHO.[1;30mINFO: No audio. )
ECHO.[0m
ECHO.[31m^(!!^)    DO NOT close or click inside this window!    ^(!!^)[0m
ECHO.        [1;31mIf you accidentally did, press backspace.
TIMEOUT /T 1 /NOBREAK>NUL
TASKLIST /FI "WINDOWTITLE eq Battles Of Batch*" | FIND /I /N ":" || GOTO START
IF ERRORLEVEL 1 GOTO START
TASKLIST /FI "WINDOWTITLE eq Select Battles Of Batch*" | FIND /I /N ":"
IF ERRORLEVEL 1 GOTO START
TASKLIST /FI "WINDOWTITLE eq Battles Of Batch*" | FIND /I /N ":"
IF ERRORLEVEL 1 GOTO START
:END
%ERRORLEVEL% >>"%LOG_INFO%"
%INFO%Exit Code %ERRORLEVEL% >>"%LOG_INFO%"
TASKKILL /F /FI "WINDOWTITLE eq wscript.exe*" /T>NUL
IF EXIST "%DATA_TMP_A%" DEL /Q "%DATA_TMP_A%"
EXIT