IF NOT EXIST "%PLAYERDATA.ITEMS%" ECHO.>"%PLAYERDATA.ITEMS%"
GOTO %1 %2 %3

:REGISTER
SET TMP.NAME=
FOR /F "DELIMS=" %%A IN ('TYPE "%DATA_SCRIPTS%\list\items.txt"') DO (
	CALL :REGISTER_ALT %%A
)
EXIT /B 0
:REGISTER_ALT
ECHO.RAN
SET TMP.LIST=%1
FOR /F "tokens=1*DELIMS=" %%1 IN ("%TMP.LIST:$= %") DO (
	CALL :REGISTER_ALT_O %%1 %%2 %%3 %%4 %5
)
EXIT /B 0
:REGISTER_ALT_O
SET TMP.NAME=%1
SET I.%TMP.NAME%.CLVL=%2
SET I.%TMP.NAME%.TYPE=%3
SET I.%TMP.NAME%.DMG=%4
SET I.%TMP.NAME%.DESC=%5
EXIT /B 0

:SEARCH
FOR /F "delims=" %%A IN ('FINDSTR %2 %PLAYERDATA.ITEMS%') DO SET TEXT=%%A
SET ITEM.IS=0
FOR /F "tokens=*" %%A IN ('TYPE "%PLAYERDATA.ITEMS%"') DO (
	IF %%A==%2 (
		SET ITEM.IS=1
	)
)
EXIT /B %ITEM.IS%

:LIST
SET CNT=0
FOR /F %%A IN ('TYPE "%PLAYERDATA.ITEMS%"') DO (
	CALL :LIST_REG %%A
)
EXIT /B 0
:LIST_REG
SET /A CNT+=1
SET VAR.IS=%1
FOR /F "tokens=1*" %%1 IN ("%VAR.IS:!= %") DO (
	SET LIST_NAME=%%1
	SET LIST_LVL=%%2
)
SET ITEM.REG_NAME.%CNT%=%LIST_NAME%
SET ITEM.REG_LVL.%CNT%=%LIST_LVL%
SET ITEM.REG_CNT=%CNT%
EXIT /B 0

:WEAPONS
SET WIELDING.WEAPON=
SET CNT=0
FOR /F %%A IN ('TYPE "%PLAYERDATA.WEAPONS%"') DO (
	CALL :WEAPONS_REG %%A
)
EXIT /B 0
:WEAPONS_REG
SET /A CNT+=1
SET VAR.IS=%1
FOR /F "tokens=1,2,3" %%1 IN ("%VAR.IS:$= %") DO (
	SET UI.POS_%CNT%_W=%%1
	SET LIST_NAME=%%1
	SET LIST_LVL=%%2
	SET IS.WEAPON=%%3
	IF %%3 EQU 1 SET WIELDING.WEAPON=%CNT%
)
SET WEAPONS.REG_NAME.%CNT%=%LIST_NAME%
SET WEAPONS.REG_LVL.%CNT%=%LIST_LVL%
SET WEAPONS.REG_CNT=%CNT%
EXIT /B 0

:LIST_EQ
SET CNT=0
FOR /F %%A IN (%PLAYERDATA.EQ%) DO (
	CALL :LIST_EQ_ %%A
)
EXIT /B 0
:LIST_EQ_
SET /A CNT+=1
SET VAR.IS=%1
FOR /F "tokens=1*" %%1 IN ("%VAR.IS:!= %") DO (
	SET LIST_NAME=%%1
	SET LIST_LVL=%%2
)
SET ITEM.EQ_NAME.%CNT%=%LIST_NAME%
SET ITEM.EQ_LVL.%CNT%=%LIST_LVL%
SET ITEM.EQ_CNT=%CNT%
EXIT /B 0

:EQUIP
SETLOCAL ENABLEDELAYEDEXPANSION
IF !ITEM.REG_NAME.%3!.==. EXIT /B 1
FOR /f "delims=" %%A IN ('FINDSTR %2 %PLAYERDATA.ITEMS%') DO SET TEXT=%%A
REM FOR /F "tokens=*" %%A IN (%PLAYERDATA.EQ%) DO (
	REM IF %%A==%3 (
		REM EXIT /B 2
	REM )
REM )
CALL :REPLACE %3
(FOR /f "tokens=1*delims=:" %%a IN ('findstr /n "^" "%PLAYERDATA.EQ%"') DO (
	SET "Line=%%b"
	IF %%a EQU %2 SET "Line=%3"
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO(!Line!
	ENDLOCAL
))>"%PLAYERDATA.EQ%.new"
MOVE "%PLAYERDATA.EQ%.new" "%PLAYERDATA.EQ%">NUL
ENDLOCAL
EXIT /B 0

:EQUIP_W
SETLOCAL ENABLEDELAYEDEXPANSION
SET CNT.FIND_W=0
SET TMP.W_EQUIP=
::IF !ITEM.REG_NAME.%3!.==. EXIT /B 1
::FOR /f "delims=" %%A IN ('FINDSTR %2 %PLAYERDATA.ITEMS%') DO SET TEXT=%%A
FOR /F "tokens=*" %%A IN ('TYPE "%PLAYERDATA.WEAPONS%"') DO (
	CALL :EQUIP_W_FIND %%A %2
)
(FOR /f "tokens=1*delims=:" %%a IN ('findstr /n "^" "%PLAYERDATA.WEAPONS%"') DO (
	SET "Line=%%b"
	IF %%a EQU %CNT.FIND_W.FINAL% SET "Line=%CNT.FIND_W.NAME%0"
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO(!Line!
	ENDLOCAL
))>"%PLAYERDATA.WEAPONS%.new"
MOVE "%PLAYERDATA.WEAPONS%.new" "%PLAYERDATA.WEAPONS%">NUL
(FOR /f "tokens=1*delims=:" %%a IN ('findstr /n "^" "%PLAYERDATA.WEAPONS%"') DO (
	SET "Line=%%b"
	IF %%a EQU %2 SET "Line=%TMP.W_EQUIP:~0,-1%1"
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO(!Line!
	ENDLOCAL
))>"%PLAYERDATA.WEAPONS%.new"
MOVE "%PLAYERDATA.WEAPONS%.new" "%PLAYERDATA.WEAPONS%">NUL
ENDLOCAL
EXIT /B 0
:EQUIP_W_FIND
SET /A CNT.FIND_W+=1
SET TMP.W_REMOVE=%1
IF %CNT.FIND_W%==%2 (
	FOR /F "tokens=*" %%A IN ("%TMP.W_REMOVE%") DO SET TMP.W_EQUIP=%%A
)
IF %TMP.W_REMOVE:~-1%==1 (
	IF NOT DEFINED CNT.FIND_W.FINAL SET CNT.FIND_W.FINAL=%CNT.FIND_W%
	SET CNT.FIND_W.NAME=%TMP.W_REMOVE:~0,-1%
	EXIT /B 0
) ELSE EXIT /B 0
:UNEQUIP_W
SETLOCAL ENABLEDELAYEDEXPANSION
SET CNT.FIND_W=0
SET TMP.W_EQUIP=
::IF !ITEM.REG_NAME.%3!.==. EXIT /B 1
::FOR /f "delims=" %%A IN ('FINDSTR %2 %PLAYERDATA.ITEMS%') DO SET TEXT=%%A
FOR /F "tokens=*" %%A IN ('TYPE "%PLAYERDATA.WEAPONS%"') DO (
	CALL :EQUIP_W_FIND %%A %2
)
(FOR /f "tokens=1*delims=:" %%a IN ('findstr /n "^" "%PLAYERDATA.WEAPONS%"') DO (
	SET "Line=%%b"
	IF %%a EQU %CNT.FIND_W.FINAL% SET "Line=%CNT.FIND_W.NAME%0"
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO(!Line!
	ENDLOCAL
))>"%PLAYERDATA.WEAPONS%.new"
MOVE "%PLAYERDATA.WEAPONS%.new" "%PLAYERDATA.WEAPONS%">NUL
ENDLOCAL
EXIT /B 0

:REPLACE
SET FOUND=FALSE
SET COUNT=0
FOR /F "tokens=*" %%A IN (%PLAYERDATA.EQ%) DO (
	SET /A COUNT+=1
	IF %%A==%1 (
		SET FOUND=TRUE
		CALL :FINAL-COUNT
	)
)

IF %FOUND%==FALSE ( EXIT /B 0 )

(FOR /f "tokens=1*delims=:" %%a IN ('findstr /n "^" "%PLAYERDATA.EQ%"') DO (
	SET "Line=%%b"
	IF %%a EQU %FINAL.COUNT% SET "Line=EMPTY"
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO(!Line!
	ENDLOCAL
))>"%PLAYERDATA.EQ%.new"
MOVE "%PLAYERDATA.EQ%.new" "%PLAYERDATA.EQ%">NUL
EXIT /B 0

:FINAL-COUNT
SET FINAL.COUNT=%COUNT%
EXIT /B 0