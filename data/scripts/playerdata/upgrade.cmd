IF NOT DEFINED VERCODE EXIT

SET /A TMP.SKILL=SKILL.%1
SET LVL.REQ=
SET SKILL.COST=

SETLOCAL ENABLEDELAYEDEXPANSION

:: Extract the level values
FOR /F "TOKENS=%TMP.SKILL%DELIMS=;" %%I IN ("!SKILL.%1.LVLS!") DO (
	SET LVL.REQ=%%I
)
:: Extract the price values
FOR /F "TOKENS=%TMP.SKILL%DELIMS=;" %%I IN ("!SKILL.%1.COST!") DO (
	SET SKILL.COST=%%I
)

IF NOT DEFINED LVL.REQ EXIT /B 1
IF NOT DEFINED SKILL.COST SET SKILL.COST=0

IF NOT %PLAYER.LVL% GEQ !LVL.REQ! EXIT /B 1

IF %PLAYER.MONEY% LSS !SKILL.COST! EXIT /B 1


(
ENDLOCAL
SET SKILL.COST=%SKILL.COST%
)

CALL "%SAVE%" "FILE=%DATA_SAVES%\SKILLS.cmd" %2 /A SKILL.%1= SKILL.%1+1

CALL "%SAVE%" "FILE=%DATA_SAVES%\PLAYERDATA.cmd" 1 /A PLAYER.MONEY= %PLAYER.MONEY%-%SKILL.COST%

CALL "%DATA_SAVES%\PLAYERDATA.cmd"

EXIT /B 0
