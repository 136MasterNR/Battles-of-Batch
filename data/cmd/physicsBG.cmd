@ECHO OFF
SET OLD_POS=3
SET PHASE=2
SET STREAK=0
:LOOP
SET /p GET_POS=<..\temp\GET_POS
IF DEFINED DIRECTION IF %OLD_POS%.==%GET_POS%. IF %PHASE%==0 IF %STREAK% GEQ 3 (
	TIMEOUT /T 0 >NUL
	IF %DIRECTION%.==1. (
		ECHO.[%GET_POS%;0H[2A[20CBOBS
		ECHO.[%GET_POS%;0H[1A[20C    
	)
	IF %DIRECTION%.==2. (
		ECHO.[%GET_POS%;0H[20CBOBS
		ECHO.[%GET_POS%;0H[1A[20C    
	)
	SET PHASE=1
	TIMEOUT /T 0 >NUL
)
IF DEFINED DIRECTION IF %OLD_POS%.==%GET_POS%. IF %PHASE%==1 IF %STREAK% GEQ 3 (
	IF %DIRECTION%.==1. (
		ECHO.[%GET_POS%;0H[2A[20C    
		ECHO.[%GET_POS%;0H[1A[20CBOBS
	)
	IF %DIRECTION%.==2. (
		ECHO.[%GET_POS%;0H[20C    
		ECHO.[%GET_POS%;0H[1A[20CBOBS
	)
	SET STREAK=0
	SET PHASE=2
)
:: If not moved, loop
IF %GET_POS%.==%OLD_POS%. (
	IF NOT %STREAK% LEQ 0 SET /A STREAK-=1
	GOTO :LOOP
) ELSE IF NOT %STREAK% GEQ 3 SET /A STREAK+=1

IF NOT %PHASE%==0 SET PHASE=0

:: Simulate a delay
CALL "%WAIT%" 100 >NUL

ECHO.[%GET_POS%;0H[1A[20CBOBS
ECHO.[%OLD_POS%;0H[1A[20C    

IF %OLD_POS%0 GEQ %GET_POS%0 SET DIRECTION=1
IF %OLD_POS%0 LEQ %GET_POS%0 SET DIRECTION=2

SET OLD_POS=%GET_POS%
GOTO :LOOP
