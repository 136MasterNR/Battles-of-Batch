::Created by 136MasterNR - Read the "copyright.txt" file for more info.
::(Use "Notepad++" or anything other than "Notepad" to view better this file)
:: ______ ______ ______ ______ ______ ______ ______ ______ _____ __
::/_____//_____//_____//_____//_____//_____//_____//_____//_____\\_\
::    _____        __           _____ _             _ _         |/ / 
::   |  __ \      / _|         / ____| |           | |_)        | |
::   | |__) |__ _| |_ _   _   | (___ | |_ _   _  __| |_  ___    | |
::   |  _  // _` |  _| | | |   \___ \| __| | | |/ _` | |/ _ \   | | 
::   | | \ \ (_| | | | |_| |   ____) | |_| |_| | (_| | | (_) |  | | 
::   |_|  \_\__,_|_|  \__,_|  |_____/ \__|\__,_|\__,_|_|\___/   | |
:: ______ ______ ______ ______ ______ ______ ______ ______ _____|\_\
::/_____//_____//_____//_____//_____//_____//_____//_____//_____//_/
::
::                                                           !!!! WARNING !!!!                                                         ::
:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - ::
::                                                                                                                                     ::
:: (!) DO NOT EDIT THIS FILE UNLESS YOU KNOW WHAT YOU ARE DOING - EDITING ANYTHING IN HERE MAY CAUSE MISS BEHAVIOR AND CAUSE PROBLEMS  ::
::     ON YOUR COMPUTER (!)                                                                                                            ::
:: (!) IF ANYONE TOLD YOU TO COPY AND PASTE CODE IN HERE OR DOWNLOAD ADDITIONAL FILES, THEY ARE MOST LIKELY TRYING TO SCAM YOU,        ::
::     UNLESS YOU ARE A TESTER AND THE OFFICIAL DEVELOPERS TOLD YOU TO DO SO (!)                                                       ::
::                                                                                                                                     ::
:: - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - ::
::                                                                                                                                     ::
:LAUNCHER
@SET OCD=%CD%
@PUSHD "%~dp0"
@TITLE Battles of Batch - Loading
@CHCP 65001 >NUL
@PROMPT !^>
@VERIFY OFF
@ECHO OFF

ECHO.[3 q[?25l Preparing ...
FOR /F "TOKENS=4-5 DELIMS= " %%I IN ('VER') DO SET WINVER=%%I
IF NOT "=%WINVER:~0,3%" == "=10." (
	CLS
	ECHO.You are NOT running a supported OS or OS Version. Upgrade/Change your OS to Windows 10 or 11!
	PAUSE>NUL
	EXIT 1
)

:: Check if game is already running by trying to access its error logging file.
DEL /Q ".\data\logs\errors.txt" 1>NUL 2>NUL
IF EXIST ".\data\logs\errors.txt" (
	ECHO. Already running, failed to launch [X]
	ECHO.Game was already running at %TIME%>>".\data\logs\logs.txt"
	CSCRIPT "%CD%\data\scripts\focus.vbs" "Battles of Batch - " >NUL
	EXIT 1
)

IF NOT %1.==READY. IF %1.==LAUNCH. (
	CLS
	TITLE Launcher
	ECHO.This is the game's launcher, do not close.
	START /WAIT "Launcher" "conhost.exe" -- "%~dpnx0" READY
	ECHO.Shutting down...
	TASKKILL /F /FI "WINDOWTITLE eq WSAudio*" /IM "cmd.exe" /T>NUL
	TASKKILL /F /IM "easyrp.exe" /T>NUL
	EXIT 0
) ELSE (
	(IF EXIST ".\data\scripts\invisible.vbs" (
		START "wscript.exe" ".\data\scripts\invisible.vbs" "%~dpnx0" LAUNCH
	) ELSE (
		START /MIN "Launcher" conhost.exe -- "%~dpnx0" LAUNCH
	)) && (ECHO. Launched [‚àö]) || (ECHO. There was an unexpected error, failed to launch [X])
	EXIT 0
)

:: Check if logs folder exist,
IF NOT EXIST ".\data\logs" MD ".\data\logs"
::  start the logger and check if accessible,
2>".\data\logs\errors.txt" (
	SET RUNNING=TRUE
	CALL :STARTUP
)
::   if not accessible then exit, else below command will be skipped.
IF DEFINED RUNNING (
	::If it enters this statement then throw an error,
	::this usually means that the game's main function has crashed.
	CALL :ERROR ERRLINE IDUNEXPECTED_CRASH    0
)
EXIT 1

:STARTUP
:: Check if directory files are accessible, such as itself.
IF NOT EXIST "%~nx0" (
	CLS
	ECHO.ERR : Inaccessible Directory.
	ECHO.
	ECHO.Try the following:
	ECHO.1. Do not run the batch file within a zip file or any winrar format.
	ECHO.2. Make sure that the batch file has permissions to Read/Write in this directory.
	ECHO.3. Do not launch the batch file directly from a search bar or a run-in.
	ECHO.4. If you are using a shortcut, make sure you added the correct directory.
	ECHO.5. Try launching with administrator/elevated permissions.
	PAUSE>NUL
	EXIT

:: Check if the game can reach the directory.
:: This can be a problem if the directory contains characters that batch doesn't understand.
) ELSE IF NOT EXIST "%CD%" (
	CLS
	ECHO.ERR : Unreachable Directory.
	ECHO.
	ECHO.Try the following:
	ECHO.1. Move the game ^(the whole folder^) to a different location.
	ECHO.2. Make sure the directory's URL name includes ONLY latin characters.
	ECHO.3. Do not move it to shared folders or onedrive.
	PAUSE>NUL&EXIT
)

:: Checks if the directory was altered, this mostly happens when launched in a zip file.
IF NOT "%CD%"=="%OCD%" (
	CLS
	ECHO.ERR : Altered Directory.
	ECHO.
	ECHO.Try the following:
	ECHO.1. Make sure to extract the game from the zip file.
	ECHO.2. Bad shortcut options, such as working directory.
	ECHO.3. Do not launch from shared folders or onedrive.
	ECHO.4. Do not launch with Administrator Privileges.
	PAUSE>NUL&EXIT
)

:: Check whether the scripts are accessible.
FOR /F "TOKENS=*" %%I IN ('DIR /S /B /A-D ".\data\scripts"') DO IF NOT "%%~nI"=="" (
	TYPE "%%~dpnxI" >NUL || (
		CLS
		ECHO.[X] Access denied:
		ECHO."%%~dpnxI"
		>&2 ECHO.[X] Access denied: "%%~dpnxI"
		PAUSE
		EXIT /B 1
	)
)

:RESTART
COLOR 0F
SET COLS=117
SET LINES=48
MODE CON:COLS=%COLS% LINES=%LINES%
ECHO.[H[s Loading ...
::VAR:-Core Variables
SET "DM=%CD%"
SET "DATA=%CD%\data"
SET "DATA_TMP=%DATA%\temp"
IF NOT EXIST "%DATA_TMP%" MD "%DATA_TMP%"
SET "DATA_IMAGES=%DATA%\images"
SET "DATA_SCRIPTS=%DATA%\scripts"
CALL "%DATA_SCRIPTS%\versions.cmd" || CALL :ERROR ERRLINE ID0001    0
REM Detect Errors
IF NOT DEFINED VERCODE CALL :ERROR ERRLINE ID0001A    0
IF NOT DEFINED VERS CALL :ERROR ERRLINE ID0001B    0
IF NOT DEFINED VERTYPE CALL :ERROR ERRLINE ID0001C    0
SET "HTS_DATA=%APPDATA%\HTS_DATA"
SET "MAIN_GAME=%HTS_DATA%\BATTLESOFBATCH-%VERTYPE%-%VERCODE%"
SET "DATA_SETTINGS=%MAIN_GAME%\SETTINGS"
SET "HTSANI=%DATA_SCRIPTS%\htsani.cmd"
SET "WAIT=%DATA_SCRIPTS%\wait.vbs"
SET "TITLE=Battles of Batch - "
SET "COPYRIGHT=copyright.txt"
SET "LICENSE=license.txt"
SET "UPDATER=%DATA_SCRIPTS%\updater.cmd"
SET "ENEMY=%DATA_SCRIPTS%\game\enemy.cmd"
SET "EVENT=%DATA_SCRIPTS%\game\event.cmd"
SET "DEBUG.GAMELOADER=%DATA_SCRIPTS%\debug"
SET SHOP.TAB=2
SET "SCRIPTS_POP=%DATA_SCRIPTS%\pop"
SET "DEV_ERR=%SCRIPTS_POP%\deverr.cmd"
SET "CHOICE=CALL ^"%DATA_SCRIPTS%\choice.bat^""
SET "INPUT_PART=nul"
::VAR:-Saves Manager
SET "PLAYERDATA.LVL=%DATA_SCRIPTS%\playerdata\lvl.cmd"
SET "ITEMS.LOADER=%DATA_SCRIPTS%\playerdata\items.cmd"
SET "SYS_LVL=%DATA_SCRIPTS%\playerdata\sys_lvl"
SET "SAVE=%DATA_SCRIPTS%\save.cmd"
::VAR:-Settings
SET "SETTINGS.LOAD=%DATA_SETTINGS%\settings.cmd"
SET "SETTING=%DATA_SCRIPTS%\settings.cmd"
SET "IGNORE_ERRORS=FALSE"
::VAR:-Cleanup
SET OLD.PLAYER.LVL=
SET UDERFINE=
SET RAINBOWMODE=
::VAR:-Audio
SET "AUDIOMANAGER=%DATA_SCRIPTS%\audiomanager.cmd"
SET "SFX.ATK=game\player\attack\swing_"
SET "SFX.ATK.CRIT=game\player\attack\crit_"
SET "SFX.ATK.MISS=game\player\attack\miss_"
SET "SFX.BOMB=game\player\substat\bomb"
SET "SFX.LASER=game\player\substat\laser"
SET "AUD.MENU=system\menu.mp3"
SET "AUD.BATTLE.NORMAL=game\battle\winternight.mp3"
SET "AUD.BATTLE.BOSS=%DATA_AUDIO_G_B%\dangerousplains.mp3"
::VAR:-Interface
SET "INTERFACE=%DATA_SCRIPTS%\interface"
SET "STAT.MONEY=%INTERFACE%\money.cmd"
SET "STAT.XP=%INTERFACE%\xp.cmd"
SET "STAT.MAP=%INTERFACE%\map.cmd"
SET "STAT.LVL=%INTERFACE%\lvl.cmd"
SET "STAT.CMAPS=%INTERFACE%\cmaps.cmd"
SET "INT.TITLE=%INTERFACE%\title.cmd"
SET "INT.TITLE_R=%INTERFACE%\title_r.cmd"
SET "IG.CMDS=%INTERFACE%\ingame\commands.cmd"
SET "UI.ITEMS=%INTERFACE%\shop\items.cmd"
SET "UI.SKILLS=%INTERFACE%\shop\skills.cmd"
SET "UI.CRAFT=%INTERFACE%\shop\craft.cmd"
SET "CENTER=%INTERFACE%\center.cmd"
SET "CENTER_OLD=%INTERFACE%\center_old.cmd"
SET "CHARACTER=%INTERFACE%\characters.cmd"
SET "UI.MONEY=%INTERFACE%\money_decimals.cmd"
SET INV_CHOICE=1
SET INV_CHOICE_SLOT=1
SET W_INV_CHOICE=1
SET SEL_POS.Y=16
SET SEL_POS.X=11
SET UI_SEL=1
::VAR:-Craft
SET "CRAFT.INFO=%INTERFACE%\shop\craft_info.cmd"
SET CRAFT.SEL=0
SET CRAFT.NAV=0
::VAR:-Registry
SET "REG_1=HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\{22d6f312-b0f6-11d0-94ab-0080c74c7e95}"
SET "REG_2=HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\{6BF52A52-394A-11d3-B153-00C04F79FAA6}"
SET REG_C1=
SET REG_C2=
::VAR:-Battle Loader
SET "SCRIPTS_GAME=%DATA_SCRIPTS%\game"
SET "LOAD.LEVEL_=%DATA%\levels\lvl"
::VAR:-Actions
SET "SCRIPTS.ACT=%SCRIPTS_GAME%\acts"
SET "ACT.ENEMY=%SCRIPTS.ACT%\enemy_act.cmd"
SET "ACT.SIMPSONS.LASER=%SCRIPTS.ACT%\LASER.cmd"
SET "CMD.CLEARVAR=%SCRIPTS_GAME%\CLEARVAR.cmd"
::VAR:-Map
SET SELECTED=0
SET CHAPTER=1
SET "MAP.LOAD=%INTERFACE%\map"
::VAR:-ANSI Coloring
SET "RGB=[38;2;"
SET "RGB.COIN=%RGB%252;255;166m"
SET "RGB.MONEY=%RGB%70;232;110m"
SET "RGB.LVL=%RGB%128;200;255m"
SET "RGB.BLUE=%RGB%128;200;255m"
SET "RGB.TRUE=%RGB%163;255;177m"
SET "RGB.FALSE=%RGB%255;89;89m"
SET "RGB.CYAN=%RGB%133;222;255m"
SET "RGB.AQUA=%RGB%0;254;254m"
SET "RGB.YELLOW=%RGB%255;252;176m"
SET "RGB.ORANGE=%RGB%255;209;143m"
SET "RGB.VERMILION=%RGB%2242;97;53m"
SET "RGB.RED=%RGB%255;61;51m"
SET "RGB.PINK=%RGB%245;105;105m"
SET "RGB.PURPLE=%RGB%194;200;255m"
SET "RGB.GREEN=%RGB%102;255;0m"
SET "RGB.LIME=%RGB%146;224;157m"
SET "RGB.GRAY=%RGB%169;169;169m"
SET "RGB.LIGHTGRAY=%RGB%222;222;222m"
SET "RGB.BLACK=%RGB%69;69;69m"
SET "RGB.WHITE=%RGB%255;255;255m"
SET "RGB.AQUAMARINE=%RGB%127;255;212m"
SET "RGB.BROWN=%RGB%255;176;79m"
::VAR:-Player Stats
SET PLAYER.XP=
SET PLAYER.XP.REQ=45
SET PLAYER.LVL=0
SET PLAYER.MAP.LEVEL=1
SET PLAYER.MONEY=0
SET CRIT.RATE=4
SET "SEL.CHARACTER=SIMPSONS"
::VAR:-Shop
SET SHOP.PRICE.HEAL=25
SET SHOP.MAX.HEAL=3
SET SHOP.LVLREQ.HEAL=2
SET SHOP.PRICE.BOMB=150
SET SHOP.LVLREQ.BOMB=3
SET SHOP.MAX.BOMB=1
::VAR:-Skills
SET "SKILL.UPGRADE=%DATA_SCRIPTS%\playerdata\upgrade.cmd"
SET SKILL.ATK.BASE=15
SET SKILL.ATK.LVLS=1;5;7;12
SET SKILL.ATK.COST=44;784;1520;5800
SET SKILL.CRIT_RATE.BASE=4
SET SKILL.CRIT_RATE.LVLS=5;6;7;8;9;10;12;13;14;15;16;17;18;20;21;22;23;25;30;35;45;50;60
SET SKILL.CRIT_RATE.COST=150;275;1100;1500;11250;17500;25000;55000;87500;125000;250000;500000
SET SKILL.HP.BASE=25
SET SKILL.HP.LVLS=4;10
SET SKILL.HP.COST=250;2400
SET SKILL.STO.BASE=1
SET SKILL.STO.LVLS=6
SET SKILL.STO.COST=1200
::VAR:-Quests
SET "QUEST.LOADER=%DATA_SCRIPTS%\quests.cmd"
SET "QNAME.TOTAL_MONSTERS=Sereal Killer"
SET QREW.MONEY.TOTAL_MONSTERS=9750
SET QREW.XP.TOTAL_MONSTERS=18000
SET QMAX.TOTAL_MONSTERS=200
SET "QDESC.TOTAL_MONSTERS=[1;37mKill a total of [4m%QMAX.TOTAL_MONSTERS%[0m[1;37m enemies."
SET "QNAME.MTYPE=All The Species"
SET QMAX.MTYPE=29
SET "QDESC.MTYPE=[1;37mKill every single type of enemy."
SET "QNAME.LOSE=For God's Sake"
SET QREW.MONEY.LOSE=125
SET QREW.XP.LOSE=50
SET QMAX.LOSE=4
SET "QDESC.LOSE=[1;37mLose the battle [4m%QMAX.LOSE%[0m[1;37m times."
SET "QNAME.TLVLS=The Champ"
SET QREW.MONEY.TLVLS=18000
SET QREW.XP.TLVLS=45000
SET QMAX.TLVLS=120
SET "QDESC.TLVLS=[1;37mWin [4m%QMAX.TLVLS%[0m[1;37m battles."
::VAR:-DLC
SET "DLC.DIR=%DATA%"
SET "DLC.MAIN=%DLC.DIR%\1_example"
SET "DLC.MAIN.AUDIO=%DLC.MAIN%\audio"
::VAR:-Rich Presence
SET "RichManager=%DATA_SCRIPTS%\rp\RichManager.bat"
SET "State=nul"
SET "Details=nul"
SET "LargeImage=icon"
SET "LargeImageTooltip=Battle of Batch"
SET "SmallImage="
SET "SmallImageTooltip="
SET StartTimestamp=0
SET EndTimestamp=0

FOR /F "TOKENS=1* DELIMS==" %%A IN ('SET QMEM_') DO (
  SET "%%A="
)

::VAR-Player Data
ECHO.[u Loading ... System ^& Config

IF NOT EXIST "%HTS_DATA%" MD "%HTS_DATA%"
IF NOT EXIST "%HTS_DATA%" (
	ECHO.Failed to create directory "HTS_DATA" on "%APPDATA%".
	ECHO.Quitting ... Press Any Key
	PAUSE>NUL
	EXIT /B 1
)


IF NOT EXIST "%MAIN_GAME%" (
	MD "%MAIN_GAME%"
	IF NOT EXIST "%MAIN_GAME%" (
		ECHO.Couldn't create directory at
		ECHO.%MAIN_GAME%
		ECHO.
		ECHO.Press any key to exit.
		PAUSE>NUL
		EXIT 1
	)
)

IF NOT EXIST "%MAIN_GAME%\main.config" (
	ECHO.[SYSTEM]
	ECHO.profile=Wanderer
	ECHO.unitsWarning=null
	ECHO.licenseAgreed=none
	ECHO.terminal=0
)>"%MAIN_GAME%\main.config"

:: Read the config file
FOR /F "TOKENS=1,2DELIMS==" %%A IN (%MAIN_GAME%\main.config) DO (
	IF NOT %%B.==. (
		SET %%A=%%B
	)
)

IF NOT DEFINED profile (
	DEL /Q "%MAIN_GAME%\main.config"
	GOTO RESTART
)

SET "DATA_SAVES=%MAIN_GAME%\SAVES\%profile%"
SET "DATA_SAVES.INV=%DATA_SAVES%\inv"
SET "PLAYERDATA.LOAD=%DATA_SAVES%\PLAYERDATA.cmd"
SET "PLAYERSKILLS.LOAD=%DATA_SAVES%\SKILLS.cmd"

::VAR:-Inventory
SET "PLAYERDATA.ITEMS=%DATA_SAVES.INV%\ITEMS"
SET "PLAYERDATA.EQ=%DATA_SAVES.INV%\EQUIP"
SET "PLAYERDATA.MATERIALS=%DATA_SAVES.INV%\MATERIALS"
SET "PLAYERDATA.WEAPONS=%DATA_SAVES.INV%\WEAPONS"

FOR /F "tokens=1,2" %%A IN ('mode con') do (
	IF "%%A"=="Lines:" SET GETLINES=%%B
	IF "%%A"=="Columns:" SET GETCOLS=%%B
)

IF NOT EXIST "%DATA_SAVES%" MD "%DATA_SAVES%"
IF NOT EXIST "%DATA_SETTINGS%" MD "%DATA_SETTINGS%"
IF NOT EXIST "%DATA_SAVES.INV%" MD "%DATA_SAVES.INV%"

:: Get the supported bit units.
REG Query "HKLM\Hardware\Description\System\CentralProcessor\0" | FIND /i "x86" > NUL && SET OSBIT=32 || SET OSBIT=64

IF %unitsWarning%==null (
	IF %OSBIT%==32 (
		CLS
		ECHO WARNING!
		ECHO.Your device does not support 64-bit units.
		ECHO.It's highly recommended to upgrade!
		ECHO.
		ECHO.Due to this, you may be dealing with various unexpected
		ECHO.minor issues while playing the game.
		ECHO.
		ECHO.Press any key to continue or just exit.
		PAUSE>NUL
		CLS
	)
	CALL "%SAVE%" "FILE=%MAIN_GAME%\main.config" 3 unitsWarning=false
)

:: Agree to the license.
IF NOT %licenseAgreed%==GNU_GPLv3 IF EXIST "%LICENSE%" (
	CLS
	ECHO.Please read and confirm that you agree with our License!
	ECHO.By closing the License text window you agree, and be
	ECHO.able to continue playing the game.
	START /WAIT "" "%LICENSE%"
	CALL "%SAVE%" "FILE=%MAIN_GAME%\main.config" 4 licenseAgreed=GNU_GPLv3
	CLS
) ELSE (
	CLS
	ECHO.No ACCEPTED license was found within this product.
	ECHO.Using a product without its lisence is illegal.
	ECHO.
	ECHO.Please consider reinstalling this product.
	ECHO.If this solution does not help, please contact us to find a solution.
	PAUSE>NUL
	EXIT 0
)

REM Setup for input.bat
SET INPUT=^
FOR %%. IN (1 2) DO IF %%.==2 (^
FOR /F "DELIMS=" %%I IN ('.\data\scripts\input.bat !ARGS!') DO ^
	SET "UDERFINE=%%I"^
) ELSE SET ARGS=

REM Super Characters
FOR /F %%A IN ('COPY /Z "%COMSPEC%" NUL') DO SET "CR=%%A"
FOR /F %%A IN ('"PROMPT $H$E&FOR %%B IN (1) DO REM"') DO SET "BS=%%A" 

REM Shortcut
IF EXIST "Battles of Batch.lnk" GOTO SETT-MAKE
SET SCSCRIPT="%TEMP%\%random%-%random%-%random%-%random%.vbs"
(
	ECHO Set oWS = WScript.CreateObject^("WScript.Shell"^)
	ECHO sLinkFile = "%cd%\Battles of Batch.lnk"
	ECHO Set oLink = oWS.CreateShortcut^(sLinkFile^)
	ECHO oLink.TargetPath = "%cd%\%~n0"
	ECHO oLink.WorkingDirectory = "%cd%"
	ECHO oLink.IconLocation = "%DATA_IMAGES%\icon_256.ico"
	ECHO oLink.WindowStyle = 7
	ECHO oLink.Save
) > %SCSCRIPT%
CSCRIPT /nologo %SCSCRIPT% || CALL :ERROR ERRLINE ID0003    -0
DEL %SCSCRIPT%

:: SETTINGS READER
:SETT-MAKE
ECHO.[u Loading ... Preferences     
SET AUDIO.VALUE=
SET VOLUME=
SET SFX.VOLUME=
SET AUTOSAVE.VALUE=
SET UPDATE.VALUE=
SET SHOW.INTRO=
SET RICHPRESENCE.VALUE=
IF NOT EXIST "%DATA_SETTINGS%\settings.cmd" CALL :SETT_ERR
CALL %SETTINGS.LOAD%

:: Detect any missing settings
IF NOT DEFINED AUDIO.VALUE CALL :SETT_ERR
IF NOT DEFINED VOLUME CALL :SETT_ERR
IF NOT DEFINED SFX.VOLUME CALL :SETT_ERR
IF NOT DEFINED AUTOSAVE.VALUE CALL :SETT_ERR
IF NOT DEFINED UPDATE.VALUE CALL :SETT_ERR
IF NOT DEFINED SHOW.INTRO CALL :SETT_ERR
IF NOT DEFINED RICHPRESENCE.VALUE CALL :SETT_ERR

REG QUERY "%REG_1%" > NUL
IF ERRORLEVEL 1 SET REG_C1=TRUE
REG QUERY "%REG_2%" > NUL
IF ERRORLEVEL 1 SET REG_C2=TRUE

IF DEFINED REG_C1 (
	IF DEFINED REG_C2 (
		IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 CALL "%SETTING%" AUDIO
		SET DENIED_AUDIO=TRUE
		CALL "%SETTINGS.LOAD%"
	)
)

IF "%UPDATE.VALUE%"=="TRUE" (
	ECHO.[u Loading ... Retrieving updates
	CALL "%UPDATER%" 2>NUL
	CLS
)

ECHO.[u Loading ... Registering Items ^(1/2)
CALL "%ITEMS.LOADER%" REGISTER
ECHO.[u Loading ... Registering Items ^(2/2)
CALL "%ITEMS.LOADER%" LIST

ECHO.[u Loading ... Player Data            

CALL "%DATA_SCRIPTS%\mapnames.cmd"
CALL "%DATA_SAVES%\PLAYERDATA.cmd" || CALL :ResetPlayerData
SET /A "SELECTED=%PLAYER.MAP.LEVEL%"
IF %SELECTED% GTR 13 SET SELECTED=1
IF NOT DEFINED PLAYER.XP CALL :ResetPlayerData
IF NOT DEFINED PLAYER.MONEY CALL :ResetPlayerData
IF NOT DEFINED PLAYER.LVL CALL :ResetPlayerData
IF NOT DEFINED PLAYER.MAP.LEVEL CALL :ResetPlayerData
IF NOT DEFINED PLAYER.XP.REQ CALL :ResetPlayerData

IF NOT EXIST "%PLAYERDATA.ITEMS%" COPY NUL "%PLAYERDATA.ITEMS%" >NUL
IF NOT EXIST "%PLAYERDATA.WEAPONS%" COPY NUL "%PLAYERDATA.WEAPONS%" >NUL
IF NOT EXIST "%PLAYERDATA.MATERIALS%" COPY NUL "%PLAYERDATA.MATERIALS%" >NUL
IF EXIST "%PLAYERDATA.EQ%" FOR /F %%I IN ("%PLAYERDATA.EQ%") DO IF %%~ZI==0 DEL "%PLAYERDATA.EQ%"
IF NOT EXIST "%PLAYERDATA.EQ%" (
	ECHO.EMPTY>"%PLAYERDATA.EQ%"
	ECHO.EMPTY>>"%PLAYERDATA.EQ%"
	ECHO.EMPTY>>"%PLAYERDATA.EQ%"
	ECHO.EMPTY>>"%PLAYERDATA.EQ%"
)

CALL "%DATA_SAVES%\QUESTS.cmd"||((
		ECHO.SET Q.TOTAL_MONSTERS=0
		ECHO.SET Q.MONSTER_TYPE=0
		ECHO.SET Q.LOSE=0
		ECHO.EXIT /B 0
	)>"%DATA_SAVES%\QUESTS.cmd"
	CALL "%DATA_SAVES%\QUESTS.cmd"
)

SET SKILL.ATK=
SET SKILL.CRIT_RATE=
SET SKILL.HP=
SET SKILL.STO=

CALL "%PLAYERSKILLS.LOAD%" || (
	CALL :ResetSkills
)

IF NOT DEFINED SKILL.ATK CALL :ResetSkills
IF NOT DEFINED SKILL.CRIT_RATE CALL :ResetSkills
IF NOT DEFINED SKILL.HP CALL :ResetSkills
IF NOT DEFINED SKILL.STO CALL :ResetSkills

ECHO.[u Loading ... Player Inventory ^(1/2)
CALL "%ITEMS.LOADER%" LIST_EQ
ECHO.[u Loading ... Player Inventory ^(2/2)
CALL "%ITEMS.LOADER%" WEAPONS

ECHO.[u Loading ... Audio Management       
IF NOT DEFINED AUDIO.VALUE CALL :SETT_ERR
IF NOT DEFINED VOLUME CALL :SETT_ERR

IF %RICHPRESENCE.VALUE%==TRUE (
	START /MIN "RichManager" "%RichManager%"
	START /MIN "RichManager" "%RichManager%" START
)

MODE CON:COLS=%COLS% LINES=%LINES%
ECHO. Loading ... Display Features

CALL "%DATA_SAVES%\PLAYERDATA.cmd" || CALL :ERROR ERRLINE ID0005    -0
CALL "%SYS_LVL%" || CALL :ERROR ERRLINE ID0006    -0
SET OLD.PLAYER.LVL=%PLAYER.LVL%

IF %SHOW.INTRO%==TRUE (
	TITLE %TITLE%HTS
	CALL "%HTSANI%" || CALL :ERROR ERRLINE ID0007    -0
	CSCRIPT "%WAIT%" 750 >NUL || CALL :ERROR ERRLINE ID0008    -0
)

:MENU
@CHCP 65001>NUL
IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 CALL "%AUDIOMANAGER%" START system\villageambiance.mp3 menu True %VOLUME%
CLS
:S-MENU
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Menu;LargeImage=preview_menu;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
TITLE %TITLE%Menu
:REFRESH-MENU
CALL "%PLAYERDATA.LOAD%"
CALL "%SYS_LVL%"
CALL "%UI.MONEY%"

IF %PLAYER.LVL% LSS 60 ( SET "CRTLVL=%PLAYER.LVL%" ) ELSE (SET "CRTLVL=%PLAYER.LVL% MAX")
SETLOCAL ENABLEDELAYEDEXPANSION
SET "STR=%RGB.GREEN%Money[0m: [1m%PLAYER.MONEY.INTF% %RGB.GREEN%$[0m"
CALL "%CENTER%" STR 54
SET "UI.MENU.MO=%STR%"
SET "STR=%RGB.LVL%Level[0m:[1m ‚Üë%CRTLVL% %RGB.GRAY%([0mXP%RGB.GRAY%: [0m%PLAYER.XP%%RGB.GRAY%/[0m%PLAYER.XP.REQ%%RGB.GRAY%)[0m"
CALL "%CENTER%" STR 54
SET "UI.MENU.XP=%STR%"
SET "STR=%RGB.RED%Next Battle[0m: [1m!MAP.NAME.%PLAYER.MAP.LEVEL%:_= ! %RGB.GRAY%([0mTotal Wins%RGB.GRAY%: [0m%COMPLETED.MAPS%%RGB.GRAY%)[0m"
CALL "%CENTER%" STR 54
SET "UI.MENU.MA=%STR%"
(ECHO.[0m[H[?25l.-------------------------------------------------------------------------------------------------------------------.
IF "%RAINBOWMODE%"=="TRUE" ( CALL "%INT.TITLE_R%" ) ELSE ( CALL "%INT.TITLE%" )
ECHO.'-.--------[1;30m.[0m--[1;30m.[0m------------.                                                             .------------------------.-'[E.-'--------[1;30m^|[0m--[1;30m^|[0m------------'                    .---.-----------.---.                    '------------------------'-.
ECHO.^|          [1;30m^|  ^|[0m             .------------------'    :   [1;34mSTATS[0m   :    '------------------.                           ^|
ECHO.^|          [1;30m^|  ^|[0m             \                       '-----------'                       /        _   ,_,   _        ^|
ECHO.^|  \_      [1;30m^|  ^|[0m      _/     /   !UI.MENU.XP!  \       / `'=^) ^(='` \       ^|
ECHO.^|   ]'--___[1;30m^|[0m__[1;30m^|[0m___--'[      \   !UI.MENU.MO!  /      /.-.-.\ /.-.-.\      ^|
ECHO.^|   ^|       ^|^|       ^|      /   !UI.MENU.MA!  \      `      ^"      `      ^|
ECHO.^|   \       ^|^|       /      \             .--------------------------------.            /                           ^|
ECHO.^|    [      ^|^|      ]        '-----------'                                  '----------'                            ^|
ECHO.^|    ^|______^(^)______^|                                  [1;37mWelcome^^![0m                                                     ^|
ECHO.^|    ^|----^(^(^<^>^)^)----^|                                                                                               ^|
ECHO.^|    ]      ^(^)      [                                                                                               ^|
ECHO.^|     \     ^|^|     /                              .--.----------.--.                                                ^|
ECHO.^|      [    ^|^|    ]                   .----------'   : [1;34mCOMMANDS[0m :   '----------.                                    ^|
ECHO.^|      \    ^|^|    /             [1m,-,_[0m  ^|              '----------'              ^|                                    ^|
ECHO.^|       [   ^|^|   ]              [1m^|  _T[0m ^| Press %RGB.CYAN%A[0m - [1;37mSelect a level.[0m              ^|                                    ^|
ECHO.^|        \__^|^|__/               [1m'-`^|^|[0m ^| - - - - - - - - - - - - - - - - - - -  ^|                          ,_,       ^|
ECHO.^|          '--'                   :[1m^|^|[0m-^| Press %RGB%138;167;255mQ[0m - [1;37mView your quests.[0m            ^|                         ^(.,.^)      ^|
ECHO.^|                                 :[1m^|^|[0m-^| - - - - - - - - - - - - - - - - - - -  ^|                         ^(   ^)      ^|
ECHO.^|                                  [1m[][0m ^| Press %RGB%105;255;147mW[0m - [1;37mBuy items ^& skills.[0m %RGB.GRAY%^(Z/X/C^)[0m  ^|                         -"-"-------^|
ECHO.^|                                     ^| - - - - - - - - - - - - - - - - - - -  ^|                                    ^|
ECHO.^|                                     ^| Press %RGB%191;255;221mE[0m - [1;37mManage your character.[0m       ^|                                    ^|
ECHO.^|                                     ^| - - - - - - - - - - - - - - - - - - -  ^|                                    ^|
ECHO.^|                                     ^| Press %RGB%249;241;165mS[0m - [1;37mChange your preferences.[0m     ^|                                    ^|
ECHO.^|              /\_[]_/\               ^| - - - - - - - - - - - - - - - - - - -  ^|                                    ^|
ECHO.^|             ^|] _^|^|_ [^|              '.             Press a Key              .'                                    ^|
ECHO.^|        ___   \/ ^|^| \/                '--------------------------------------'                                     ^|
ECHO.^|       ‚ï±\_/‚ï≤     ^|^|                                                                                                ^|
ECHO.^|      ^(^|√≤ √≥^|^)    ^|^|                                 .    '    .                                                    ^|
ECHO.^|    __/{\^^/}\____^|^|                                   _______                                                      ^|
ECHO.^|   / \  {~}  /__^|_]                              _  .`_^|___^|_`.  _                                                 ^|
ECHO.^|   ^| /\  ~  /    []                                  \ \   / /                             ___                     ^|
ECHO.^|   ^|_^| ^)   ^(     ''                                   \ ' ' /                           __/_  `.  .-'''-. .        ^|
ECHO.^|   \_]/_____\                                          \ ^" /                            \_,` ^| \-'  /   ^)`-'       ^|
ECHO.^|     _\_^| ^|_/_                                          \./                              ___Y  ,    .'7 /^|         ^|
ECHO.^|    ^(_,_^| ^|_,_^)                                          V                              ^(_,___/...-` ^(_/_/         ^|[E^|                                                                                         [1;30m2023¬©136MasterNR[0m          ^|[114D[1;30mBATTLES OF BATCH [0;33m%VERS%-%VERTYPE%[0m[?25h)
ECHO.^|     .                              .    .                              .    .                              .      ^|[E^|     ^|       ^|       .       ^|      ^|    ^|       ^|       .       ^|      ^|    ^|       ^|       .       ^|      ^|      ^|[E'-----'-------'-------'-------'------'----'-------'-------'-------'------'----'-------'-------'-------'------'------'[2A
ENDLOCAL
IF NOT %OLD.PLAYER.LVL%==%PLAYER.LVL% CALL "%SCRIPTS_POP%\lvlup.cmd"
CALL "%DATA_SCRIPTS%\pop\daily.cmd" || GOTO S-MENU
CALL "%QUEST.LOADER%" LOAD
IF DEFINED Q.POPUP.IS (
	SET "Q.POPUP.IS="
	GOTO S-MENU
)
:: Daily rewards check
SET UDERFINE=
:CHOICE-INPUTS
SET /P "=[34;61H "<NUL
%CHOICE%
IF EXIST LET.DEBUG (
	ECHO.%CHOICE.INPUT%
	ECHO.Pressed: '%CHOICE.INPUT%'>>"debug.log"
)
IF %CHOICE.INPUT%.==. GOTO CHOICE-INPUTS
IF /I %CHOICE.INPUT%==A GOTO MAP
IF /I %CHOICE.INPUT%==E GOTO CHARACTER
IF /I %CHOICE.INPUT%==P (
	SET RETURN_TO=S-MENU
	GOTO PROFILES
)
IF /I %CHOICE.INPUT%==Q GOTO QUESTS
IF /I %CHOICE.INPUT%==S GOTO SETTINGS
IF /I %CHOICE.INPUT%==W GOTO SHOP
IF /I %CHOICE.INPUT%==X (
	SET "SHOP.TAB=1"
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==C (
	SET "SHOP.TAB=2"
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==Z (
	SET "SHOP.TAB=3"
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==K (
	CALL :DAILY
	GOTO S-MENU
)
IF /I %CHOICE.INPUT%==V GOTO CREDITS
IF /I %CHOICE.INPUT%==. START "" "https://github.com/136MasterNR/Battles-of-Batch#menu-60"
IF /I %CHOICE.INPUT%==I IF %ITEM.REG_CNT%==0 (SET /P "=[4C%RGB.FALSE%UI_ERR: ITEMS LIST IS EMPTY   [2G"<NUL) ELSE GOTO S-MENU
IF /I %CHOICE.INPUT%==R (MODE CON:COLS=%COLS% LINES=%LINES%&GOTO MENU)
IF /I %CHOICE.INPUT%== (
	IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 CALL "%AUDIOMANAGER%" STOPALL
	GOTO RESTART
)
IF /I %CHOICE.INPUT%== IF %terminal% EQU 1 (
	CALL :TERMINAL
	GOTO MENU
)
IF /I %CHOICE.INPUT%== (
	TASKKILL /F /FI "WINDOWTITLE eq WSAudio*" /IM "cmd.exe" /T>NUL
	TASKKILL /F /IM "easyrp.exe" /T>NUL
	POPD
	EXIT 0
)
IF /I %CHOICE.INPUT%== GOTO RESET
IF /I %CHOICE.INPUT%== (
	CALL "%UPDATER%" MANUAL
	GOTO MENU
)
IF /I %CHOICE.INPUT%== (
	IF DEFINED RAINBOWMODE ( SET "RAINBOWMODE=" ) ELSE SET "RAINBOWMODE=TRUE"
	GOTO REFRESH-MENU
)
IF /I %CHOICE.INPUT%== (
	CALL "%EVENT%"
	GOTO MENU
)

GOTO CHOICE-INPUTS
:DAILY
FOR /F "DELIMS=" %%N IN ('DATE /T') DO (
	IF EXIST "%DATA_SAVES%\MEMORY" (
		FOR /F "DELIMS=" %%O IN (%DATA_SAVES%\MEMORY) DO (
			IF NOT "%%N"=="%%O " (
				CALL "%DATA_SCRIPTS%/pop/daily.cmd" %%N
			)
			EXIT /B 0
		)
	) ELSE (
		ECHO.%%N>"%DATA_SAVES%\MEMORY"
		ECHO.0>>"%DATA_SAVES%\MEMORY"
	)
)
EXIT /B 0

:TERMINAL
MODE CON:COLS=126 LINES=9216
CLS
IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 START "" /MIN CMD /C "%AUDIOMANAGER%" STOPALL
TITLE %TITLE%Command Line Enviroment
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Terminal;LargeImage=cmd;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
ECHO.[38;2;166;255;245m^(‚Ä¢^) [38;2;207;255;250mBattles of Batch [37m[Version %VERCODE% / %VERTYPE% %VERS%]
ECHO.[38;2;166;255;245m^(‚Ä¢^) [38;2;207;255;250mMicrosoft Windows [37m[Version %WINVER:]=%]
ECHO.[38;2;235;64;52m^(^!^) [38;2;245;108;98mRun "EXIT" to return.[0m[3H[?25h
PUSHD "%CD%\DATA\cmd"
CMD /K "PROMPT $E[38;2;132;217;52mbob@terminal$E[0m$E[1m:$E[38;2;113;155;198m%%cd:~-9,9%%[0m$$$S"
IF EXIST memory.dmp (
	CLS & ECHO.Carrying variables from the dump file ...
	for /f "tokens=1,* delims==" %%a in (memory.dmp) do (
		SET %%a=%%b
	)
	DEL "memory.dmp" /Q
)
POPD
IF %ERRORLEVEL%==2 GOTO STARTUP
MODE CON:COLS=%COLS% LINES=%LINES%
EXIT /B 0

:CREDITS
TITLE %TITLE%Credits
CLS
ECHO.[ PROGRAMMING ]
ECHO.Everything by "136MasterNR"
ECHO.
ECHO.[ STORY ]
ECHO.Directed by "136MasterNR" ^& "johnypro150"
ECHO.
ECHO.[ ASCII-ART ]
ECHO.Character Designs by "136MasterNR", "asciiart.eu", "patorjk.com"
ECHO.Layout Designs by "136MasterNR"
ECHO.
ECHO.[ SOUNDS ]
ECHO.Menu Soundtrack by "Alexander Nakarada"
ECHO.Boss Soundtrack by "pedi me arxes" (Made For This Project)
ECHO.Other Soundtracks by "Unwind Station"
ECHO.
ECHO.[ SFX ]
ECHO.Swing Sound Effects by "SOUND and IMAGE FX"
ECHO.Other Sound Effects by "epicstockmedia.com"
ECHO.
ECHO.[ TESTERS ]: "AboodXD", "bench", "BlackStorm", "2002Spiele"
ECHO.      ^(OLD^): "AgentANP", "ComradeTurtle", "JayKayHere3987"
ECHO.
ECHO.
ECHO.%RGB.TRUE%DISCLAIMER: Any unauthorized Assets used for this project are not claimed by us, and are used with no copyright
ECHO.            statements from the authors. You can find the true author's watermarks ^& names below:[0m
ECHO.[1msnd[ASCII:MAN^&AXE], Donovan Bake[ASCII:DIAMOND], Nobody[ASCII:BANNER], Donovan Bake/dwb[ASCII:BIRD], jgs[ASCII:BAT][0m
ECHO.
ECHO.[0mPress any key to return...[?47l
PAUSE>NUL
GOTO S-MENU

:CHARACTER
TITLE %TITLE%Character ^& Equipment
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Character [and] Equipment;LargeImage=preview_character;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch

COLOR 08
ECHO.[?25l[1;37m[20H[49C
ECHO.[45C.-------------------------.
ECHO.[45C^|   [1mReading Player Data[0m   ^|
ECHO.[45C^|          [s               ^|
ECHO.[45C^|     [1mPlease Wait ...[0m     ^|
ECHO.[45C'-------------------------'
SET ITEMS.IS=
SET WEAPON.IS=
ECHO.[u  0%%
::Default enemy locations
SET LOC.W1=87
SET LOC.W2=92
SET LOC.W3=86
SET LOC.H1=4
SET LOC.H2=13
SET LOC.H3=22
ECHO.[u  2%%
::CALL "%ITEMS.LOADER%" REGISTER
ECHO.[u 19%%
CALL "%ITEMS.LOADER%" LIST
ECHO.[u 46%%
CALL "%ITEMS.LOADER%" LIST_EQ
ECHO.[u 63%%
CALL "%ITEMS.LOADER%" WEAPONS
ECHO.[u 79%%
CALL "%ITEMS.LOADER%" MATERIALS
ECHO.[u 91%%
CALL "%CHARACTER%" MAIN
ECHO.[u 98%%
SET EFFECT.BONUS_CRIT=0
SETLOCAL ENABLEDELAYEDEXPANSION

:: Stylefi's bonus effect
IF !WEAPONS.REG_NAME.%WIELDING.WEAPON%!==Stylefi (
	ENDLOCAL
	IF %SKILL.CRIT_RATE% LSS 19 (
		SET /A EFFECT.BONUS_CRIT+=10
	) ELSE IF %SKILL.CRIT_RATE% EQU 19 (
		SET /A EFFECT.BONUS_CRIT+=5
	)
) ELSE ENDLOCAL

SET /A STAT.NUM.HP=SKILL.HP * SKILL.HP.BASE
SET /A STAT.NUM.ATK=(SKILL.ATK.BASE * SKILL.ATK) + EQUIP.BONUS_ATK
SET /A STAT.NUM.CRIT_RATE=(SKILL.CRIT_RATE * SKILL.CRIT_RATE.BASE) + EFFECT.BONUS_CRIT
ECHO.[u100%%
(
ECHO.[?25l[H[0m.---.---------------------------------------------------------------------------------------------------------------.
ECHO.^| %RGB.PINK%Q[0m ^|                                                                                                               ^|
ECHO.^|---'.-------------------.                    .-----------------------.                    .----------------------. ^|
ECHO.^|    : [1mPress %RGB.YELLOW%[4mP[0m[1m to switch[0m :                 .--: %RGB%158;177;255mCharacter[0m ^& %RGB%133;255;196mEquipment[0m :--.                 : Press X to customize : ^|
ECHO.^|    : [1myour profile[0m .----'              .--'  '-----------------------'  '--.              '----. your appearance : ^|
ECHO.^|    '-------------' .-----: %RGB%252;255;179mName[0m :-----:                                   :----: %RGB.TRUE%Health[0m :----. '----------------' ^|
ECHO.^|                    : %RGB%253;255;209m^>[0m                :        %C.FRAME_0%       : %RGB%191;255;186m‚ô•[0m [s               :                    ^|[u%STAT.NUM.HP%[u[55D%profile:_= %
ECHO.^|                    '------------------:        %C.FRAME_1%       :------------------'                    ^|
ECHO.^|                                       :        %C.FRAME_2%       :                                       ^|
ECHO.^|                     .----: %RGB%122;255;126mMoney[0m :----:        %C.FRAME_3%       :--: %RGB.FALSE%Strength[0m :---.                     ^|
ECHO.^|                     : %RGB%179;255;181m$[0m               :        %C.FRAME_4%       : %RGB.PINK%‚ïÄ[0m [s              :                     ^|[u%STAT.NUM.ATK%[u[54D%PLAYER.MONEY.INTF%
ECHO.^|                     '-----------------:        %C.FRAME_5%       :-----------------'                     ^|
ECHO.^|                                       :        %C.FRAME_6%       :                                       ^|
ECHO.^|                     .----: %RGB.LVL%Level[0m :----:        %C.FRAME_7%       :--: %RGB%255;201;125mCrit Rate[0m :--.                     ^|
ECHO.^|                     : %RGB%194;228;255m‚Üë[0m               :        %C.FRAME_8%       : %RGB%255;209;143m÷ç[0m [s              :                     ^|[u%STAT.NUM.CRIT_RATE%%%[u[54D%PLAYER.LVL%
ECHO.^|                     '-----------------:        %C.FRAME_9%       :-----------------'                     ^|
ECHO.^|                                       :                                   :                                       ^|
ECHO.^|                       .----: %RGB%176;255;247mExp[0m :----:--------.                 .--------:--: %RGB%161;250;255mDefense[0m :--.                       ^|
ECHO.^|                       : %RGB%199;255;249m‚Ä¢[0m             :         '---------------'         : %RGB%201;252;255m‚ñ≤[0m [s            :                       ^|[u0[u[52D%PLAYER.XP%
ECHO.^|                       '---------------'                                   '---------------'                       ^|
ECHO.^|                                                                                                                   ^|
ECHO.^|          [1mPress %RGB.CYAN%[4mA[0m[1m to equip an Item[0m                                               [1mPress %RGB.CYAN%[4mD[0m[1m to equip a Weapon[0m         ^|
ECHO.^|      .--------.-----------.--------.     .--------.-----------.--------.     .--------.-----------.--------.      ^|
ECHO.^|      : .-'-.- :   [1mItems[0m   : -.-'-. :     : -/\/\- : [1mMaterials[0m : -/\/\- :     : -^|---- :  [1mWeapons[0m  : ----^|- :      ^|
ECHO.^|      '--------'-----------'--------'     '--------'-----------'--------'     '--------'-----------'--------'      ^|
ECHO.^|      . - - : [1mEQUIPPED  ITEMS[0m : - - .     . - - : [1mOWNED MATERIALS[0m : - - .     . - - : [1mEQUIPPED WEAPON[0m : - - .      ^|
ECHO.^|      : 1:                          :     : [s                            :     :                             :      ^|
ECHO.^|      : 2:                          :     :                             :     '                             '      ^|
ECHO.^|      : 3:                          :     :                             :     . - - :  [1mOWNED WEAPONS[0m  : - - .      ^|
ECHO.^|      : 4:                          :     :                             :     :                             :      ^|
ECHO.^|      '                             '     :                             :     :                             :      ^|
ECHO.^|      . - - - : [1mOWNED ITEMS[0m : - - - .     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :                             :     :                             :     :                             :      ^|
ECHO.^|      :  [1mPress %RGB.CYAN%[4mA[0m[1m to view all Items[0m  :     :                             :     : [1mPress %RGB.CYAN%[4mD[0m[1m to view all Weapons[0m :      ^|
ECHO.^|      '-----------------------------'     '-----------------------------'     '-----------------------------'      ^|
ECHO.^|                                                                                                                   ^|
ECHO.'-------------------------------------------------------------------------------------------------------------------'[22A
)
SETLOCAL ENABLEDELAYEDEXPANSION
SET UI.POS=[12C
IF NOT DEFINED ITEM.EQ_CNT (ECHO.%UI.POS%EMPTY) ELSE FOR /L %%A IN (1,1,%ITEM.EQ_CNT%) DO (IF !ITEM.EQ_NAME.%%A!==EMPTY (ECHO.%UI.POS%%RGB.GRAY%EMPTY[0m) ELSE (CALL :INVENTORY-EQUIPPED %%A !ITEM.EQ_NAME.%%A!))
ECHO.[1B
SET UI.POS=[9C
IF %ITEM.REG_CNT% GTR 11 (SET TMP.ITEM.REG_CNT=11) ELSE SET TMP.ITEM.REG_CNT=%ITEM.REG_CNT%
SET /A MORE_HIDDEN=%ITEM.REG_CNT%-11
IF %MORE_HIDDEN% EQU 1 (SET MORE_HIDDEN=  ... ^(%MORE_HIDDEN% Hidden Item^) ...) ELSE IF %MORE_HIDDEN% LEQ 9 (SET MORE_HIDDEN= ... ^(%MORE_HIDDEN% Hidden Item/s^) ...) ELSE (SET MORE_HIDDEN=  ... ^(Hidden Items^) ...)
IF %ITEM.REG_CNT%==0 (ECHO.%UI.POS% You do not own any items) ELSE FOR /L %%A IN (1,1,%TMP.ITEM.REG_CNT%) DO (ECHO.%UI.POS%%RGB.CYAN%!ITEM.REG_NAME.%%A![0m √ó[1m!ITEM.REG_LVL.%%A![0m)
IF %ITEM.REG_CNT% GTR 11 ECHO.%UI.POS%%MORE_HIDDEN%
SET UI.POS=[81C
IF %MAT.REG_CNT%==0 (ECHO.[u    No materials owned) ELSE FOR /L %%A IN (1,1,%MAT.REG_CNT%) DO (
	CALL :MAT_DISPLAY !MAT.REG_NAME.%%A! !MAT.REG_X.%%A! %%A
)
IF %WEAPONS.REG_CNT% GTR 14 (SET TMP.ITEM.REG_CNT=14) ELSE SET TMP.ITEM.REG_CNT=%WEAPONS.REG_CNT%
SET /A MORE_HIDDEN=%WEAPONS.REG_CNT%-14
IF %MORE_HIDDEN% EQU 1 (SET MORE_HIDDEN=  ... ^(%MORE_HIDDEN% Hidden Item^) ...) ELSE IF %MORE_HIDDEN% LEQ 9 (SET MORE_HIDDEN= ... ^(%MORE_HIDDEN% Hidden Item/s^) ...) ELSE (SET MORE_HIDDEN=  ... ^(Hidden Items^) ...)
IF DEFINED WIELDING.WEAPON (ECHO.[u[36C1: %RGB.YELLOW%!WEAPONS.REG_NAME.%WIELDING.WEAPON%:_= ! %RGB%245;105;105m‚ïÄ[0m[1m%EQUIP.BONUS_ATK%[0m[2B) ELSE (ECHO.[u[36C    No equipped weapons[2B)
SET UI.POS=[81C

IF %WEAPONS.REG_CNT%==0 (
	ECHO.%UI.POS%     No weapons owned
) ELSE FOR /L %%A IN (1,1,%TMP.ITEM.REG_CNT%) DO (
	CALL :WEAPON-GET-INFO !WEAPONS.REG_NAME.%%A! %%A
)
IF %WEAPONS.REG_CNT% GTR 14 ECHO.%UI.POS%%MORE_HIDDEN%
ENDLOCAL
SET /P "=[?25h[2;3H"<NUL
:CHARACTER-RE
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO CHARACTER-RE
IF /I %CHOICE.INPUT%.==R. (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO CHARACTER
)
IF /I %CHOICE.INPUT%.==X. SET /P "=[4C%RGB.FALSE%UI_ERR: CHAR_CUST UNAVAILABLE   [2G"<NUL
IF /I %CHOICE.INPUT%.==P. (
	SET RETURN_TO=CHARACTER
	GOTO PROFILES
)
IF /I %CHOICE.INPUT%.==A. IF %ITEM.REG_CNT%==0 (SET /P "=[4C%RGB.FALSE%UI_ERR: ITEMS LIST IS EMPTY   [2G"<NUL) ELSE GOTO INV-CHOOSE_ITEM-RE
IF /I %CHOICE.INPUT%.==D. IF %WEAPONS.REG_CNT%==0 (SET /P "=[4C%RGB.FALSE%UI_ERR: WEAPONS LIST IS EMPTY   [2G"<NUL) ELSE GOTO INV-CHOOSE_WEAPON-RE
IF /I %CHOICE.INPUT%.==. START "" "https://github.com/136MasterNR/Battles-of-Batch#character--equipment-63"
IF /I %CHOICE.INPUT%==Q GOTO S-MENU
GOTO CHARACTER-RE

:INVENTORY
TITLE %TITLE%Inventory
ECHO.%ITEMS.IS%
IF DEFINED ITEMS.IS IF NOT DEFINED WEAPON.IS (
	ENDLOCAL
	GOTO INV-CHOOSE_WEAPON
) ELSE (
	CLS
	ECHO.You do not own any items.
	PAUSE>NUL
	GOTO S-MENU
)
:INV-CHOOSE_ITEM
CALL "%ITEMS.LOADER%" REGISTER
CALL "%ITEMS.LOADER%" LIST
CALL "%ITEMS.LOADER%" LIST_EQ
CALL "%ITEMS.LOADER%" WEAPONS
:INV-CHOOSE_ITEM-RE
CLS
ECHO.[?25l[0m[HFYI: This user interface is a [1;31mprototype[0m. Any minor visual bugs that were found will not be fixed in the near future.[2;0H[1mItems:
SETLOCAL ENABLEDELAYEDEXPANSION
SET ITEMS.IS=
SET WEAPON.IS=
IF NOT DEFINED ITEM.REG_CNT (
	SET ITEMS.IS=EMPTY
	ECHO.EMPTY
) ELSE FOR /L %%A IN (1,1,%ITEM.REG_CNT%) DO (
	ECHO.   Slot - Name: !ITEM.REG_NAME.%%A!, Amount: !ITEM.REG_LVL.%%A!
)
ECHO.
ECHO.EQUIPPED:
SET UI.POS=[3C
IF NOT DEFINED ITEM.EQ_CNT ( ECHO.EMPTY ) ELSE FOR /L %%A IN (1,1,%ITEM.EQ_CNT%) DO (
	IF !ITEM.EQ_NAME.%%A!==EMPTY ( ECHO.%UI.POS%[1mEMPTY ) ELSE (
		CALL :INVENTORY-EQUIPPED %%A !ITEM.EQ_NAME.%%A!
	)
)
ENDLOCAL&SET WEAPON.IS=%WEAPON.IS%&SET ITEMS.IS=%ITEMS.IS%
ECHO.[0m[1m[1BGuide For Items Section:                                            Guide For Weapons Section:
ECHO.[0m Press W or S to navigate between items/slots.                       Press E to change your Weapon equipment.
ECHO. Press A to confirm the item you want to add.                        Press A to confirm the chosen weapon.
ECHO. Press Q after selecting an item to reselect an item.                Press Q to return to the character ui.  
ECHO. Press CTRL X to clear your equipped items.                                                [s%RGB.COIN%
:INV-CHOOSE_ITEM
TITLE %TITLE%Inventory [%INV_CHOICE%^|%INV_CHOICE_SLOT%]
SET /A INV_CHOICE.UI=%INV_CHOICE%+2
SET /P "=[%INV_CHOICE.UI%;2H>[1C"<NUL
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO INVENTORY
IF /I %CHOICE.INPUT%==W IF NOT %INV_CHOICE% LEQ 1 (
	ECHO.[%INV_CHOICE.UI%;2H [1A
	SET /A INV_CHOICE-=1
	GOTO INV-CHOOSE_ITEM-RE
)
IF /I %CHOICE.INPUT%==S IF NOT %INV_CHOICE% GEQ %ITEM.REG_CNT% (
	ECHO.[%INV_CHOICE.UI%;2H [1A
	SET /A INV_CHOICE+=1
	GOTO INV-CHOOSE_ITEM-RE
)
IF /I %CHOICE.INPUT%==C (
	ECHO.[2D 
	GOTO INV-CHOOSE_WEAPON-RE
)
IF /I %CHOICE.INPUT%== (
	FOR /F "tokens=*" %%A IN (%PLAYERDATA.EQ%) DO (
		ECHO.EMPTY>>"%PLAYERDATA.EQ%.new"
	)
	MOVE "%PLAYERDATA.EQ%.new" "%PLAYERDATA.EQ%" >NUL
	DEL "%PLAYERDATA.EQ%.new"
	GOTO INVENTORY
)
IF /I %CHOICE.INPUT%==Q (
	GOTO CHARACTER
)
IF /I %CHOICE.INPUT%==R (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO INVENTORY
)
IF /I NOT %CHOICE.INPUT%==A GOTO INV-CHOOSE_ITEM
:INV-CHOOSE_SLOT
TITLE %TITLE%Inventory [%INV_CHOICE%^|%INV_CHOICE_SLOT%]
SET /A INV_CHOICE_SLOT.UI=%ITEM.REG_CNT%+5
SET /A INV_CHOICE_SLOT_MAX.UI=%ITEM.REG_CNT%+4+%ITEM.EQ_CNT%
SET /A INV_CHOICE_SLOT.POS=%ITEM.REG_CNT%+4+%INV_CHOICE_SLOT%
SET /P "=[%INV_CHOICE_SLOT.POS%;2H>[1C"<NUL
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO INVENTORY
IF /I %CHOICE.INPUT%==W IF NOT %INV_CHOICE_SLOT.POS% LEQ %INV_CHOICE_SLOT.UI% (
	ECHO.[%INV_CHOICE_SLOT.POS%;2H [1A
	SET /A INV_CHOICE_SLOT-=1
	GOTO INV-CHOOSE_SLOT
)
IF /I %CHOICE.INPUT%==S IF NOT %INV_CHOICE_SLOT.POS% GEQ %INV_CHOICE_SLOT_MAX.UI% (
	ECHO.[%INV_CHOICE_SLOT.POS%;2H [1A
	SET /A INV_CHOICE_SLOT+=1
	GOTO INV-CHOOSE_SLOT
)
IF /I %CHOICE.INPUT%==Q (
	ECHO.[2D [?47h
	GOTO INV-CHOOSE_ITEM
)
IF /I %CHOICE.INPUT%== (
	FOR /F "tokens=*" %%A IN (%PLAYERDATA.EQ%) DO (
		ECHO.EMPTY>>"%PLAYERDATA.EQ%.new"
	)
	MOVE "%PLAYERDATA.EQ%.new" "%PLAYERDATA.EQ%" >NUL
	DEL "%PLAYERDATA.EQ%.new"
	GOTO INVENTORY
)
IF /I %CHOICE.INPUT%== (
	FOR /F "tokens=*" %%A IN (%PLAYERDATA.EQ%) DO (
		ECHO.EMPTY>>"%PLAYERDATA.EQ%.new"
	)
	MOVE "%PLAYERDATA.EQ%.new" "%PLAYERDATA.EQ%" >NUL
	GOTO INVENTORY
)
IF /I %CHOICE.INPUT%==R (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO INVENTORY
)
IF /I %CHOICE.INPUT%==A (
	CALL "%ITEMS.LOADER%" EQUIP %INV_CHOICE_SLOT% %INV_CHOICE%
	GOTO INV-CHOOSE_ITEM
) ELSE GOTO INV-CHOOSE_SLOT
:INVENTORY-EQUIPPED
SET TMP.EQ_N=!ITEM.EQ_NAME.%1!
ECHO.%UI.POS%%RGB.CYAN%!ITEM.REG_NAME.%2![0m √ó[1m!ITEM.REG_LVL.%TMP.EQ_N%![0m
EXIT /B 0
:MAT_DISPLAY
SET TMP.DISPLAY=%1
ECHO.[u[1A[%3B%RGB.ORANGE%%TMP.DISPLAY:_= %[0m √ó[1m%2[0m
EXIT /B 0
:INV-CHOOSE_WEAPON
CALL "%ITEMS.LOADER%" REGISTER
CALL "%ITEMS.LOADER%" LIST
CALL "%ITEMS.LOADER%" LIST_EQ
CALL "%ITEMS.LOADER%" WEAPONS
:INV-CHOOSE_WEAPON-RE
CLS
::ECHO.[?25l[0m[HFYI: This user interface is a [1;31mprototype[0m. Any minor visual bugs that were found will not be fixed in the near future.
TITLE %TITLE%Inventory [%W_INV_CHOICE%]
ECHO.[?25l[2J[0m[H{Prototype} Press Q to return[E
SETLOCAL ENABLEDELAYEDEXPANSION
SET UI.POS=[3C
IF NOT DEFINED WEAPONS.REG_CNT (
	SET WEAPON.IS=EMPTY
	ECHO.[71CEMPTY
) ELSE FOR /L %%A IN (1,1,%WEAPONS.REG_CNT%) DO (
	CALL :WEAPON-GET-INFO !WEAPONS.REG_NAME.%%A! %%A
)
IF DEFINED WIELDING.WEAPON (
	ECHO.[1B[2CEQUIPPED: !WEAPONS.REG_NAME.%WIELDING.WEAPON%:_= !
) ELSE (
	ECHO.[1B[2CEQUIPPED: EMPTY
)
ENDLOCAL
ECHO.[0m[1m[1BGuide For Items Section:                                            Guide For Weapons Section:
ECHO.[0m Press W or S to navigate between items/slots.                       Press E to change your Weapon equipment.
ECHO. Press A to confirm the item you want to add.                        Press A to confirm the chosen weapon.
ECHO. Press Q after selecting an item to reselect an item.                Press Q to return to the character ui.  
ECHO. Press CTRL X to clear your equipped items.                                                [s%RGB.COIN%
:INV-CHOOSE_WEAPON-PRE
SET /A W_INV_CHOICE.UI=%W_INV_CHOICE%+2
SET /P "=[%W_INV_CHOICE.UI%;2H>[1C"<NUL
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO INVENTORY
IF /I %CHOICE.INPUT%==W IF NOT %W_INV_CHOICE% LEQ 1 (
	ECHO.[%W_INV_CHOICE.UI%;2H [1A
	SET /A W_INV_CHOICE-=1
	GOTO INV-CHOOSE_WEAPON-RE
)
IF /I %CHOICE.INPUT%==S IF NOT %W_INV_CHOICE% GEQ %WEAPONS.REG_CNT% (
	ECHO.[%W_INV_CHOICE.UI%;2H [1A
	SET /A W_INV_CHOICE+=1
	GOTO INV-CHOOSE_WEAPON-RE
)
IF /I %CHOICE.INPUT%== (
	SET REL.W=TRUE
	CALL "%ITEMS.LOADER%" UNEQUIP_W %W_INV_CHOICE%
	GOTO INV-CHOOSE_WEAPON
)
IF /I %CHOICE.INPUT%==E (
	ECHO.[2D 
	IF DEFINED ITEMS.IS (GOTO CHARACTER) ELSE GOTO INV-CHOOSE_ITEM-RE
)
IF /I %CHOICE.INPUT%==Q (
	ECHO.[2D 
	GOTO CHARACTER
)
IF /I %CHOICE.INPUT%==R (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO INV-CHOOSE_WEAPON
)
IF /I %CHOICE.INPUT%==A (	
	SET REL.W=TRUE
	CALL "%ITEMS.LOADER%" EQUIP_W %W_INV_CHOICE%
	GOTO INV-CHOOSE_WEAPON
) ELSE GOTO INV-CHOOSE_WEAPON-RE
:WEAPON-DISPLAY-INFO
::SET TMP.W_NAME=%1
::ECHO.[u, DMG: !I.%1.DMG!, TYPE: !I.%1.TYPE![E!I.%1.DESC!
ECHO.    :[45C:
SET "STR=%1"
ECHO.   :  %STR%  -  Strength: +!I.%1.DMG![G[51C:
ECHO.   ':[7CPress I for more[G[50C:'
::ECHO. [0;30m!WEAPONS.REG_NAME.%2![0m  Extra: !I.%1.DESC.1:_= ! !I.%1.DESC.2:_= !!I.%1.DESC.3:_= !!I.%1.DESC.4:_= !!I.%1.DESC.5:_= !!I.%1.DESC.6:_= !!I.%1.DESC.7:_= !
EXIT /B 0
:WEAPON-GET-INFO
SET TMP.NAME=%1
SET /A TMP.DUPE_DMG=I.%1.DMG * WEAPONS.REG_LVL.%2
ECHO.%RGB.YELLOW%%UI.POS%%TMP.NAME:_= %[0m %RGB.CYAN%‚Üë[0m[1m!WEAPONS.REG_LVL.%2! %RGB%245;105;105m‚ïÄ[0m[1m!TMP.DUPE_DMG!
EXIT /B 0

:PROFILES
TITLE %TITLE%Profiles Manager
SET PROFILE_COUNTER=0
SET SELECTED_PROFILE=
SET CNT=0
CLS

(
ECHO.[?25l[H%RGB.PINK%‚ï≠‚îÄ‚îÄ‚îÄ‚ïÆ
ECHO.‚îÇ Q ‚îÇ
ECHO.‚ï∞‚îÄ‚îÄ‚îÄ‚ïØ[0m
ECHO.[7B[25C                          %RGB.AQUAMARINE%PROFILES MANAGER[0m[1m
ECHO.[25C‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
ECHO.[25C‚îÉ[s[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ[66C‚îÉ
ECHO.[25C‚îÉ                     Navigate using [4mW[24m and [4mS[24m[23C‚îÉ
ECHO.[25C‚îÉ               Choose your desired profile using [4mA[24m[16C‚îÉ
ECHO.[25C‚îÉ       Create a profile with [4mD[24m, delete a profile with [4mCTRL[24m [4mX[24m[6C‚îÉ
ECHO.[25C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ[0m[u
FOR /L %%I IN (1, 1, 4) DO (
	ECHO.[29C%RGB.BLACK%‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
	ECHO.[1B[29C‚îÇ[13C‚îú‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î§[G[35C???[2A
	ECHO.[3B[29C‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ[4A
	ECHO.[29C‚îÇ[13C‚îÜ[44C‚îÇ[G[46CMONEY $0  [1A‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A  LEVEL ‚Üë0  [1A‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A  MAP Õº0
	ECHO.[1B[29C‚îÇ[13C‚îÜ[44C‚îÇ[G[47C‚ô• 0   [1A‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   ‚ïÄ 0   [1A‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   ÷ç 0   [1A‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   ‚ñ≤ 0[0m
	ECHO.
)
ECHO.[u
)

FOR /D %%I IN (%MAIN_GAME%\SAVES\*) DO CALL :PROFILE_DISPLAY %%~nI
CALL :PROFILE_SELECT

:PROFILES_RE
SET /P "=[2;3H[?25h"<NUL
%CHOICE%
IF /I %CHOICE.INPUT%.==R. GOTO PROFILES
IF /I %CHOICE.INPUT%.==Q. GOTO %RETURN_TO%
IF /I %CHOICE.INPUT%.==A. (
	IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 CALL "%AUDIOMANAGER%" STOPALL
	FOR /D %%I IN (%MAIN_GAME%\SAVES\*) DO CALL :APPLY %%~nI || GOTO RESTART
)
IF /I %CHOICE.INPUT%.==D. (
	CALL :CREATE_PROFILE
	GOTO PROFILES
)
IF /I %CHOICE.INPUT%.==W. IF NOT %SELECTED_PROFILE% LEQ 1 (
	SET /A SELECTED_PROFILE-=1
	CALL :PROFILE_SELECT
)
IF /I %CHOICE.INPUT%.==S. IF NOT %SELECTED_PROFILE% GEQ %PROFILE_COUNTER% (
	SET /A SELECTED_PROFILE+=1
	CALL :PROFILE_SELECT
)
IF /I %CHOICE.INPUT%.==. (
	FOR /D %%I IN (%MAIN_GAME%\SAVES\*) DO CALL :DEL_PROFILE %%~nI
	GOTO PROFILES
)
IF /I %CHOICE.INPUT%.==. (
	FOR /D %%I IN (%MAIN_GAME%\SAVES\*) DO CALL :REN_PROFILE %%~nI
	GOTO PROFILES
)
GOTO PROFILES_RE

:PROFILE_SELECT
SET /A POS=5*%SELECTED_PROFILE%

(
IF DEFINED OLD_POS ECHO.[?25l[u%RGB.YELLOW%[3A[%OLD_POS%B  [1D[1B [1D[1B [2A[62C [1D[1B [1D[1B [0m
SET OLD_POS=%POS%
ECHO.[u%RGB.YELLOW%[3A[%POS%B ^>[1D[1B^>[1D[1B^>[2A[62C^<[1D[1B^<[1D[1B^<[0m
)

EXIT /B 0

:APPLY
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\PLAYERDATA.cmd" EXIT /B 0
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\SKILLS.cmd" EXIT /B 0
SET /A CNT+=1
IF NOT %CNT% EQU %SELECTED_PROFILE% EXIT /B 0
CALL "%SAVE%" "FILE=%MAIN_GAME%\main.config" 2 profile=%1
EXIT /B 1

:PROFILE_DISPLAY
SETLOCAL ENABLEDELAYEDEXPANSION
SET ITEM=%1

IF NOT EXIST "%MAIN_GAME%\SAVES\%ITEM%\PLAYERDATA.cmd" EXIT /B 0
IF NOT EXIST "%MAIN_GAME%\SAVES\%ITEM%\SKILLS.cmd" EXIT /B 0

SET "DATA_SAVES=%MAIN_GAME%\SAVES\%ITEM%"
SET "DATA_SAVES.INV=%DATA_SAVES%\inv"
SET "PLAYERDATA.WEAPONS=%DATA_SAVES.INV%\WEAPONS"

SET PLAYER.MONEY=0
SET PLAYER.LVL=0
SET PLAYER.MAP.LEVEL=0
SET SKILL.ATK=0
SET SKILL.CRIT_RATE=0
SET SKILL.HP=0

CALL "%MAIN_GAME%\SAVES\%ITEM%\PLAYERDATA.cmd"
CALL "%MAIN_GAME%\SAVES\%ITEM%\SKILLS.cmd"
CALL "%ITEMS.LOADER%" WEAPONS

SET /A HP=SKILL.HP * SKILL.HP.BASE
SET /A ATK=(SKILL.ATK.BASE * SKILL.ATK) + EQUIP.BONUS_ATK
SET /A CRIT=SKILL.CRIT_RATE * SKILL.CRIT_RATE.BASE

SET "STR=%ITEM%"
CALL "%CENTER%" STR 11

SET /A PROFILE_COUNTER+=1
IF NOT DEFINED SELECTED_PROFILE IF %PROFILE%==%ITEM% SET SELECTED_PROFILE=%PROFILE_COUNTER%

(      ECHO.[29C%PROFILE_CLR%‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
ECHO.[1B[29C%PROFILE_CLR%‚îÇ[13C‚îú‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î§[G[31C%RGB%252;255;179m%STR:_= %[0m[2A
ECHO.[3B[29C%PROFILE_CLR%‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ[4A
      ECHO.[29C%PROFILE_CLR%‚îÇ[13C‚îÜ[44C‚îÇ[G[46C%RGB%122;255;126mMONEY %RGB%179;255;181m$%PLAYER.MONEY%[0m  [1A%PROFILE_CLR%‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A  %RGB.LVL%LEVEL %RGB%194;228;255m‚Üë%PLAYER.LVL%[0m  [1A%PROFILE_CLR%‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A  %RGB.BROWN%MAP %RGB.ORANGE%Õº%PLAYER.MAP.LEVEL%[0m
ECHO.[1B[29C%PROFILE_CLR%‚îÇ[13C‚îÜ[44C‚îÇ[G[47C%RGB%191;255;186m‚ô• %HP%[0m   [1A%PROFILE_CLR%‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   %RGB.PINK%‚ïÄ %ATK%[0m   [1A%PROFILE_CLR%‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   %RGB%255;209;143m÷ç %CRIT%[0m   [1A%PROFILE_CLR%‚î¨[1B[1D‚îÜ[1B[1D‚î¥[1A   %RGB%201;252;255m‚ñ≤ 0[0m
ECHO.)

ENDLOCAL&SET SELECTED_PROFILE=%SELECTED_PROFILE%
SET /A PROFILE_COUNTER+=1
EXIT /B 0

:CREATE_PROFILE
CLS
IF %PROFILE_COUNTER% GEQ 4 (
	ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.RED%ERROR[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚îÉ  You have reached the maximum amount of[0m     ‚îÉ
	ECHO.[34C‚îÉ  profiles and %RGB.PINK%cannot create any more[0m!       ‚îÉ
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
	ECHO.[34C‚îÉ     Delete some profiles and try again.     ‚îÉ
	ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
	ECHO.
	ECHO.[45C%RGB.GRAY%[Press any key to return]
	PAUSE>NUL
	EXIT /B 0
)
COLOR 08
ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.CYAN%INPUT[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
ECHO.[34C‚îÉ                                             ‚îÉ
ECHO.[34C‚îÉ    What should your profile be called^?      ‚îÉ
ECHO.[34C‚îÉ    This will be your %RGB.CYAN%in-game username[0m.      ‚îÉ
ECHO.[34C‚îÉ                                             ‚îÉ
ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
ECHO.[34C‚îÉ               ^> [s            ^<               ‚îÉ
ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
ECHO.
ECHO.[43C%RGB.GRAY%[Enter Q or CANCEL to cancel]
SETLOCAL ENABLEDELAYEDEXPANSION
%INPUT% "PROMPT=[0m[?25h[u[1m" "length=11"
ENDLOCAL&SET UDERFINE=%UDERFINE: =_%
IF "%UDERFINE%"==")_" GOTO CREATE_PROFILE
IF /I %UDERFINE%==Q EXIT /B 0
IF /I %UDERFINE%==CANCEL EXIT /B 0
IF EXIST "%MAIN_GAME%\SAVES\%UDERFINE%" (
	CLS
	ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.RED%ERROR[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚îÉ         The profile %RGB.PINK%already exists[0m!         ‚îÉ
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
	ECHO.[34C‚îÉ           Choose a different name,          ‚îÉ
	ECHO.[34C‚îÉ            or delete the profile.           ‚îÉ
	ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
	ECHO.
	ECHO.[46C%RGB.GRAY%[Press any key to retry]
	PAUSE>NUL
	GOTO CREATE_PROFILE
)
MD "%MAIN_GAME%\SAVES\%UDERFINE%"
BREAK>"%MAIN_GAME%\SAVES\%UDERFINE%\PLAYERDATA.cmd"
BREAK>"%MAIN_GAME%\SAVES\%UDERFINE%\SKILLS.cmd"
CALL "%SAVE%" "FILE=%MAIN_GAME%\main.config" 2 profile=%UDERFINE%
EXIT /B 0

:REN_PROFILE
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\PLAYERDATA.cmd" EXIT /B 0
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\SKILLS.cmd" EXIT /B 0
SET /A CNT+=1
IF NOT %CNT% EQU %SELECTED_PROFILE% EXIT /B 0
CLS
IF %PROFILE%==%1 (
	ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.RED%ERROR[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚îÉ  This is your currently active profile[0m,     ‚îÉ
	ECHO.[34C‚îÉ  and %RGB.PINK%cannot be renamed[0m!                     ‚îÉ
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
	ECHO.[34C‚îÉ  Activate another profile, then try again.  ‚îÉ
	ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
	ECHO.
	ECHO.[45C%RGB.GRAY%[Press any key to return]
	PAUSE>NUL
	EXIT /B 0
)
ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.CYAN%INPUT[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
ECHO.[34C‚îÉ                                             ‚îÉ
ECHO.[34C‚îÉ   How do you want to rename your profile^?   ‚îÉ
ECHO.[34C‚îÉ   This will be your %RGB.CYAN%in-game username[0m.       ‚îÉ
ECHO.[34C‚îÉ                                             ‚îÉ
ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
ECHO.[34C‚îÉ               ^> [s            ^<               ‚îÉ
ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
ECHO.
ECHO.[43C%RGB.GRAY%[Enter Q or CANCEL to cancel]
SETLOCAL ENABLEDELAYEDEXPANSION
%INPUT% "PROMPT=[0m[?25h[u[1m" "length=11"
ENDLOCAL&SET UDERFINE=%UDERFINE: =_%
IF "%UDERFINE%"==")_" GOTO REN_PROFILE
IF /I %UDERFINE%==Q EXIT /B 0
IF /I %UDERFINE%==CANCEL EXIT /B 0
REN "%MAIN_GAME%\SAVES\%1" "%UDERFINE%"
EXIT /B 0

:DEL_PROFILE
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\PLAYERDATA.cmd" EXIT /B 0
IF NOT EXIST "%MAIN_GAME%\SAVES\%1\SKILLS.cmd" EXIT /B 0
SET /A CNT+=1
IF NOT %CNT% EQU %SELECTED_PROFILE% EXIT /B 0
IF %PROFILE%==%1 (
	CLS
	ECHO.[?25l[0m[18;35H‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î´%RGB.RED%ERROR[0m‚î†‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚îÉ  This is your currently active profile[0m,     ‚îÉ
	ECHO.[34C‚îÉ  and %RGB.PINK%cannot be deleted[0m!                     ‚îÉ
	ECHO.[34C‚îÉ                                             ‚îÉ
	ECHO.[34C‚î†‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚ïå‚î®
	ECHO.[34C‚îÉ  Activate another profile, then try again.  ‚îÉ
	ECHO.[34C‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
	ECHO.
	ECHO.[45C%RGB.GRAY%[Press any key to return]
	PAUSE>NUL
	EXIT /B 0
)
RD /S /Q "%MAIN_GAME%\SAVES\%1"
EXIT /B 0

:MAP
TITLE %TITLE%Map
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Map;LargeImage=preview_map;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch

(
ECHO.[?25l[0m[H.----------------------------------------------------: %RGB.ORANGE%Level Info[0m :-------------------------------------------------.
ECHO.^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.:-------------------------------------------------------------------------------------------------------------------:[s[34B
ECHO.^|     ^|`-._/\_.-`^|                                                                                 ^|`-._/\_.-`^|     ^|
ECHO.^|     ^|    ^|^|    ^|                                                                                 ^|    ^|^|    ^|     ^|)
ECHO.^|     ^|___o()o___^|                                                                                 ^|___o()o___^|     ^|
ECHO.^|     ^|__((^<^>))__^|                                                                                 ^|__((^<^>))__^|     ^|
ECHO.^|     \   o\/o   /                                                                                 \   o\/o   /     ^|
ECHO.^|      \   ^|^|   /                          [0mPress %RGB.CYAN%[4mA[0m or %RGB.CYAN%[4mSpace[0m to begin the level.[0m                     \   ^|^|   /      ^|
ECHO.^|       \  ^|^|  /                 [0m Press %RGB.AQUAMARINE%[4mC[0m to jump [1m7[0m levels forward or %RGB.AQUAMARINE%[4mZ[0m to go backwards.[0m             \  ^|^|  /       ^|
ECHO.^|        '.^|^|.'                     [0mPress %RGB.YELLOW%[4mD[0m to move to the next level, %RGB.YELLOW%[4mS[0m for previous.[0m                '.^|^|.'        ^|
ECHO.^|          ''                                 Press %RGB.FALSE%[4mQ[0m to return to the menu.                            ''          ^|
ECHO.'-._______________________________________________________________________________________________________________.-'[4A[u
)

:MAP-RE
CALL "%MAP.LOAD%\limit.cmd"
ECHO.[u
IF %SELECTED% LEQ 7 (CALL "%MAP.LOAD%\c1.cmd") ELSE CALL "%MAP.LOAD%\c2.cmd"
CALL "%MAP.LOAD%\details.cmd" %SELECTED% %CHAPTER%

CALL "%SYS_LVL%"
IF NOT %OLD.PLAYER.LVL%==%PLAYER.LVL% CALL "%SCRIPTS_POP%\lvlup.cmd"
CALL "%QUEST.LOADER%" LOAD
IF DEFINED Q.POPUP.IS SET "Q.POPUP.IS="&GOTO MAP
:MAP-CHOICE
SET /P "=[44;44H"<NUL
%CHOICE%
IF %CHOICE.INPUT%.==SPACE. GOTO PRE_LOAD
IF %CHOICE.INPUT%.==TAB. GOTO PRE_LOAD
IF %CHOICE.INPUT%.==. GOTO PRE_LOAD
IF /I %CHOICE.INPUT%==A GOTO PRE_LOAD
IF /I %CHOICE.INPUT%==B GOTO S-MENU
IF /I %CHOICE.INPUT%==S (
	SET /A SELECTED=SELECTED-1
	CALL "%MAP.LOAD%\limit.cmd"
	IF %SELECTED% LEQ 8 (
		IF %SELECTED%==8 (
			GOTO MAP-RE
		)
		CALL "%MAP.LOAD%\c1.cmd" NUMS
	) ELSE (
		CALL "%MAP.LOAD%\c2.cmd" NUMS
	)
	GOTO MAP-CHOICE
)
IF /I %CHOICE.INPUT%==D (
	SET /A SELECTED=SELECTED+1
	CALL "%MAP.LOAD%\limit.cmd"
	IF %SELECTED% LEQ 7 (
		IF %SELECTED%==7 (
			GOTO MAP-RE
		)
		CALL "%MAP.LOAD%\c1.cmd" NUMS
	) ELSE (
		CALL "%MAP.LOAD%\c2.cmd" NUMS
	)
)
IF /I %CHOICE.INPUT%==Q GOTO S-MENU
IF /I %CHOICE.INPUT%==R ( 
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO MAP
)
IF /I %CHOICE.INPUT% GEQ 1 IF %CHOICE.INPUT% LEQ 7 (
	SET /A AF=7*CHAPTER-7
	SET /A SELECTED=%CHOICE.INPUT%+AF
	GOTO MAP
)
IF /I %CHOICE.INPUT%==C (
	SET /A SELECTED=SELECTED+7
	GOTO MAP
)
IF /I %CHOICE.INPUT%==Z (
	SET /A SELECTED=SELECTED-7
	GOTO MAP
)
IF /I %CHOICE.INPUT%.==. START "" "https://github.com/136MasterNR/Battles-of-Batch#map-61"
IF /I %CHOICE.INPUT%.==. IF %terminal% EQU 1 (
	CALL :TERMINAL
	GOTO MAP
)
GOTO MAP-CHOICE
:SHOP
CALL "%PLAYERDATA.LOAD%"
IF "%SHOP.TAB%"=="1" CALL "%UI.ITEMS%"
SET UDERFINE=
:SHOP-RE
IF "%SHOP.TAB%"=="1" SET "INPUT_PART=items"
IF "%SHOP.TAB%"=="2" (
	GOTO SKILLS-SHOP
)
IF "%SHOP.TAB%"=="3" (
	GOTO CRAFT-SHOP
)

SETLOCAL ENABLEDELAYEDEXPANSION
%INPUT% "PROMPT=[u[0m[?25h" "length=13"
ENDLOCAL&SET UDERFINE=%UDERFINE%

SET "INPUT_PART=nul"
 IF "%UDERFINE%"==") " (
	IF NOT "%SHOP.TAB%"=="3" SET /P "=|"<NUL
	GOTO SHOP-RE
 )
  IF /I "%UDERFINE%"=="BACK" GOTO S-MENU
   IF /I "%UDERFINE%"=="EXIT" GOTO S-MENU
    IF /I "%UDERFINE%"=="GO BACK" GOTO S-MENU
     IF /I "%UDERFINE%"=="MENU" GOTO S-MENU
	  IF /I "%UDERFINE%"=="RETURN" GOTO S-MENU
	   IF /I "%UDERFINE%"=="Q" GOTO S-MENU
IF /I "%UDERFINE%"=="SWITCH" IF %SHOP.TAB% LEQ 2 (
	SET /A SHOP.TAB+=1
) ELSE (
	SET SHOP.TAB=1
)
IF /I "%UDERFINE%"=="SKILLS" SET "SHOP.TAB=2"
IF /I "%UDERFINE%"=="SKILL" SET "SHOP.TAB=2"
IF /I "%UDERFINE%"=="ITEMS" SET "SHOP.TAB=1"
IF /I "%UDERFINE%"=="ITEM" SET "SHOP.TAB=1"
IF /I "%UDERFINE%"=="CRAFT" SET "SHOP.TAB=3"
IF "%SHOP.TAB%"=="1" (
	IF /I "%UDERFINE:~0,4%"=="HEAL" (
		CALL "%ITEMS.LOADER%" SHOP-ADD Heal %SHOP.MAX.HEAL% %SHOP.PRICE.HEAL% %SHOP.LVLREQ.HEAL% %UDERFINE:~5%
	)
	IF /I "%UDERFINE:~0,8%"=="BUY HEAL" (
		CALL "%ITEMS.LOADER%" SHOP-ADD Heal %SHOP.MAX.HEAL% %SHOP.PRICE.HEAL% %SHOP.LVLREQ.HEAL% %UDERFINE:~9%
	)
	IF /I "%UDERFINE:~0,4%"=="BOMB" (
		CALL "%ITEMS.LOADER%" SHOP-ADD Bomb %SHOP.MAX.BOMB% %SHOP.PRICE.BOMB% %SHOP.LVLREQ.BOMB% %UDERFINE:~5%
	)
	IF /I "%UDERFINE:~0,8%"=="BUY BOMB" (
		CALL "%ITEMS.LOADER%" SHOP-ADD Bomb %SHOP.MAX.BOMB% %SHOP.PRICE.BOMB% %SHOP.LVLREQ.BOMB% %UDERFINE:~9%
	)
)
GOTO SHOP
:SKILLS-SHOP
CALL "%UI.SKILLS%"

:SKILLS-SHOP-RE
SET OLD.POS_Y=%SEL_POS.Y%
SET OLD.POS_X=%SEL_POS.X%

SET UI_ITEM=

FOR /F "TOKENS=%UI_SEL%DELIMS=;" %%I IN ("%UI_LIST%") DO (
	SET UI_ITEM=%%I
)

IF "%UI_ITEM%"=="TRUE" (
	ECHO.[0H[%SEL_POS.Y%B[%SEL_POS.X%C%RGB.TRUE%      ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤[1B[18D[0m[1m[sPress [4m%RGB.CYAN%SPACE[0m[1m to upgrade!
) ELSE IF "%UI_ITEM%"=="FALSE" (
	ECHO.[0H[%SEL_POS.Y%B[%SEL_POS.X%C%RGB.FALSE%      ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤[1B[17D[1m[sMissing requirements!
) ELSE (
	ECHO.[0H[%SEL_POS.Y%B[%SEL_POS.X%C[0m      ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤ ‚ñ≤
)

SET /P "=[?25h[2;3H"<NUL
%CHOICE%
ECHO.[?25l
IF %CHOICE.INPUT%.==. GOTO SKILLS-SHOP-RE

IF /I %CHOICE.INPUT%==W IF NOT %SEL_POS.Y% LEQ 16 (
	ECHO.[0H[%OLD.POS_Y%B[%OLD.POS_X%C                   [1B[18D                       
	SET /A SEL_POS.Y-=12
	SET /A UI_SEL-=3
)
IF /I %CHOICE.INPUT%==S IF NOT %SEL_POS.Y% GEQ 40 (
	ECHO.[0H[%OLD.POS_Y%B[%OLD.POS_X%C                   [1B[18D                       
	SET /A SEL_POS.Y+=12
	SET /A UI_SEL+=3
)
IF /I %CHOICE.INPUT%==A IF NOT %SEL_POS.X% LEQ 15 (
	ECHO.[0H[%OLD.POS_Y%B[%OLD.POS_X%C                   [1B[18D                       
	SET /A SEL_POS.X-=36
	SET /A UI_SEL-=1
)
IF /I %CHOICE.INPUT%==D IF NOT %SEL_POS.X% GEQ 83 (
	ECHO.[0H[%OLD.POS_Y%B[%OLD.POS_X%C                   [1B[18D                       
	SET /A SEL_POS.X+=36
	SET /A UI_SEL+=1
)

IF /I %CHOICE.INPUT%==Q GOTO S-MENU
IF /I %CHOICE.INPUT%==R (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==Z (
	SET /A SHOP.TAB=1
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==C (
	SET /A SHOP.TAB=3
	GOTO SHOP
)

IF %CHOICE.INPUT%==SPACE (
	IF %UI_SEL% EQU 1 CALL "%SKILL.UPGRADE%" ATK 1 && GOTO SKILLS-SHOP
	IF %UI_SEL% EQU 2 CALL "%SKILL.UPGRADE%" HP 3 && GOTO SKILLS-SHOP
	IF %UI_SEL% EQU 3 CALL "%SKILL.UPGRADE%" CRIT_RATE 2 && GOTO SKILLS-SHOP
	IF %UI_SEL% EQU 3 CALL "%SKILL.UPGRADE%" STO 4 && GOTO SKILLS-SHOP
)

GOTO SKILLS-SHOP-RE

:CRAFT-SHOP
COLOR 08
ECHO.[?25l[1;37m[20H[49C
ECHO.[45C.-------------------------.
ECHO.[45C^|   [1mReading Player Data[0m   ^|
ECHO.[45C^|     [1mPlease Wait ...[0m     ^|
ECHO.[45C'-------------------------'
SET "INPUT_PART=craft"
TITLE %TITLE%Craft Shop
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=Crafting items;Details=Shop;LargeImage=preview_craft;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
CALL "%ITEMS.LOADER%" MATERIALS
CALL "%ITEMS.LOADER%" WEAPONS
>NUL FINDSTR /C:"Dustblade" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.1_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Dustblade%^)    ") || (SET "CRAFT.1_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Cold_Twill" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.2_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Cold_Twill%^)    ") || (SET "CRAFT.2_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Comrade_Hammer" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.3_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Comrade_Hammer%^)    ") || (SET "CRAFT.3_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Stylefi" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.4_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Stylefi%^)    ") || (SET "CRAFT.4_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Flora_Thrower" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.5_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Flora_Thrower%^)    ") || (SET "CRAFT.5_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Trident_of_Gawra" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.6_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Trident_of_Gawra%^)    ") || (SET "CRAFT.6_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Infernal_Blade" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.7_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Infernal_Blade%^)    ") || (SET "CRAFT.7_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Ornate_Cobalt" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.8_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Ornate_Cobalt%^)    ") || (SET "CRAFT.8_FOUND=   ^(Not Owned^)   ")
>NUL FINDSTR /C:"Brainleader" "%PLAYERDATA.WEAPONS%" && (SET "CRAFT.9_FOUND=   ^(Owned ‚Üë%WEAPONS.REG_LVL.Brainleader%^)    ") || (SET "CRAFT.9_FOUND=   ^(Not Owned^)   ")
ECHO.[?25l[H[0m.---.-----------------------------------------.-------.-------.-------.---------------------------------------------.
ECHO.^| %RGB.PINK%Q[0m ^|                                       Z ^| [4m[1mCraft[0m ^| Items ^| Skill ^| C                                           ^|
ECHO.^|---'                                         '-------'-------'-------'                                             ^|
ECHO.[42H^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.^|                                                                                                                   ^|
ECHO.'-------------------------------------------------------------------------------------------------------------------'[1A
:CRAFT-SHOP-RE
IF %CRAFT.SEL%==0 (SET CRAFT.UI_ITEM=Dustblade) ELSE IF %CRAFT.SEL%==1 (SET CRAFT.UI_ITEM=Cold_Twill) ELSE IF %CRAFT.SEL%==2 (SET CRAFT.UI_ITEM=Comrade_Hammer
) ELSE IF %CRAFT.SEL%==3 (SET CRAFT.UI_ITEM=Stylefi) ELSE IF %CRAFT.SEL%==4 (SET CRAFT.UI_ITEM=Flora_Thrower) ELSE IF %CRAFT.SEL%==5 (SET CRAFT.UI_ITEM=Trident_of_Gawra
) ELSE IF %CRAFT.SEL%==6 (SET CRAFT.UI_ITEM=Infernal_Blade) ELSE IF %CRAFT.SEL%==7 (SET CRAFT.UI_ITEM=Ornate_Cobalt
) ELSE IF %CRAFT.SEL%==8 (SET CRAFT.UI_ITEM=Brainleader)
SETLOCAL ENABLEDELAYEDEXPANSION
SET "STR=> [4m[s%CRAFT.UI_ITEM%[24m <"
CALL "%CENTER_OLD%" 30
ENDLOCAL&&SET "CRAFT.UI.CENTER=%STR%"
SETLOCAL ENABLEDELAYEDEXPANSION
SET "STR=!I.%CRAFT.UI_ITEM%.TYPE:_= !"
CALL "%CENTER_OLD%" 12
ENDLOCAL&&SET "CRAFT.UI.TYPE=%STR%"
ENDLOCAL
FOR /F "TOKENS=1,2,3,4,5,6 DELIMS=?" %%A IN ('CALL ECHO.%%I.%CRAFT.UI_ITEM%.MAT%%') DO (	
	SET MAT.1.NAME=%%A
	SET MAT.1.X=%%B
	SET MAT.2.NAME=%%C
	SET MAT.2.X=%%D
	SET MAT.3.NAME=%%E
	SET MAT.3.X=%%F
	>NUL FINDSTR /C:"%%A" "%PLAYERDATA.MATERIALS%" && (
		FOR /F "DELIMS=:" %%N IN ('FINDSTR /I /N %%A "%PLAYERDATA.MATERIALS%"') DO (SET MAT.1.OWNED=%%N) ) || (SET MAT.1.OWNED=0)
	>NUL FINDSTR /C:"%%C" "%PLAYERDATA.MATERIALS%" && (
		FOR /F "DELIMS=:" %%N IN ('FINDSTR /I /N %%C "%PLAYERDATA.MATERIALS%"') DO (SET MAT.2.OWNED=%%N) ) || (SET MAT.2.OWNED=0)
	>NUL FINDSTR /C:"%%E" "%PLAYERDATA.MATERIALS%" && (
		FOR /F "DELIMS=:" %%N IN ('FINDSTR /I /N %%E "%PLAYERDATA.MATERIALS%"') DO (SET MAT.3.OWNED=%%N) ) || (SET MAT.3.OWNED=0)
	)
)
IF NOT %MAT.1.OWNED%==0 CALL SET "MAT.1.OWNED=%%MAT.REG_X.%MAT.1.OWNED%%%"
IF NOT %MAT.2.OWNED%==0 CALL SET "MAT.2.OWNED=%%MAT.REG_X.%MAT.2.OWNED%%%"
IF NOT %MAT.3.OWNED%==0 CALL SET "MAT.3.OWNED=%%MAT.REG_X.%MAT.3.OWNED%%%"
IF %MAT.1.OWNED% GEQ %MAT.1.X% (SET CRAFT.UI.1.OWNED=%MAT.1.OWNED% %RGB.TRUE%‚àö[0m) ELSE (SET CRAFT.UI.1.OWNED=%MAT.1.OWNED% %RGB.FALSE%X[0m)
IF %MAT.2.OWNED% GEQ %MAT.2.X% (SET CRAFT.UI.2.OWNED=%MAT.2.OWNED% %RGB.TRUE%‚àö[0m) ELSE (SET CRAFT.UI.2.OWNED=%MAT.2.OWNED% %RGB.FALSE%X[0m)
IF %MAT.3.OWNED% GEQ %MAT.3.X% (SET CRAFT.UI.3.OWNED=%MAT.3.OWNED% %RGB.TRUE%‚àö[0m) ELSE (SET CRAFT.UI.3.OWNED=%MAT.3.OWNED% %RGB.FALSE%X[0m)
SET /A SEL.Y=(3*%CRAFT.SEL%)+8
IF %CRAFT.NAV% EQU 0 (
	ECHO.[?25l[4H[0m^|                                                                                                                   ^|
	ECHO.^|        .-------------------------.                                                                                ^|
	ECHO.^|       /  [1;30m?  ‚Üê %RGB%255;204;153mCRAFT WEAPONS[1;30m ‚Üí  ?[0m  \                   .-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+.                  ^|
	ECHO.^|      :'- - - - - - - - - - - - - -':               .-'                                          '-.               ^|
	ECHO.^|      :.                           .:               :------------: %RGB%153;153;255mMATERIALS REQUIRED[0m :------------:               ^|
	ECHO.^|       :         Dustblade         :                ^|                                              ^|               ^|
	ECHO.^|      :'     [s                      ':               ^|                                              ^|               ^|[u%CRAFT.1_FOUND%
	ECHO.^|      :.                           .:               ^|                                              ^|               ^|
	ECHO.^|       :        Cold Twill         :                ^|                                              ^|               ^|
	ECHO.^|      :'     [s                      ':               ^|                                              ^|               ^|[u%CRAFT.2_FOUND%
	ECHO.^|      :.                           .:               ^|                                              ^|               ^|
	ECHO.^|       :      Comrade Hammer       :                ^|                                              ^|               ^|
	ECHO.^|      :'     [s                      ':               ^|                                              ^|               ^|[u%CRAFT.3_FOUND%
	ECHO.^|      :.                           .:               ^|                                              ^|               ^|
	ECHO.^|       :          Stylefi          :                :------------: %RGB%204;255;204mWEAPON INFORMATION[0m :------------:               ^|
	ECHO.^|      :'     [s                      ':               :                                              :               ^|[u%CRAFT.4_FOUND%
	ECHO.^|      :.                           .:               '-.                                          .-'               ^|
	ECHO.^|       :       Flora Thrower       :                  : - %RGB%255;255;204mWeapon Type[0m -          - %RGB%255;102;102mBase Damage[0m - :                 ^|
	ECHO.^|      :'     [s                      ':                 :                                          :                 ^|[u%CRAFT.5_FOUND%
	ECHO.^|      :.                           .:                 :                                          :                 ^|
	ECHO.^|       :      Trident of Gawra     :                  :             - %RGB%204;255;255mBONUS EFFECT[0m -             :                 ^|
	ECHO.^|      :'     [s                      ':                 :                                          :                 ^|[u%CRAFT.6_FOUND%
	ECHO.^|      :.                           .:                 :                                          :                 ^|
	ECHO.^|       :      Infernal Blade       :                  :                                          :                 ^|
	ECHO.^|      :'     [s                      ':                 :                                          :                 ^|[u%CRAFT.7_FOUND%
	ECHO.^|      :.                           .:                 :                                          :                 ^|
	ECHO.^|       :       Ornate Cobalt       :                  :                                          :                 ^|
	ECHO.^|      :'     [s                      ':                 :             - %RGB%229;204;255mITEM HISTORY[0m -             :                 ^|[u%CRAFT.8_FOUND%
	ECHO.^|      :.                           .:                 :                                          :                 ^|
	ECHO.^|       :        Brainleader        :                  :                                          :                 ^|
	ECHO.^|      :'     [s                      ':                 :                                          :                 ^|[u%CRAFT.9_FOUND%
	ECHO.^|      :.                           .:                 :                                          :                 ^|
	ECHO.^|       :                           :                  :                                          :                 ^|
	ECHO.^|      :'- - - - - - - - - - - - - -':                 :-----------.------------------.-----------:                 ^|
	ECHO.^|      :.                           .:                 : -+-+-+-+- ^| Press [1;4mA[0m to craft ^| -+-+-+-+- :                 ^|
	ECHO.^|       :  Use W A S D to navigate  :                  '-----------'------------------'-----------'                 ^|
	ECHO.^|      :'                           ':                                                                              ^|
	ECHO.^|      '-----------------------------'                                                                              ^|
) ELSE ECHO.[1mCRAFT ITEMS[0m
SETLOCAL ENABLEDELAYEDEXPANSION
IF NOT %MAT.1.X%==0 ECHO.[9;56H^> %RGB%204;229;255m%MAT.1.NAME:_= %[0m[10;58H%RGB%255;100;100mReq[0m: [1m%MAT.1.X%[0m / %RGB%204;240;229mOwned[0m: [1m%CRAFT.UI.1.OWNED%[0m
IF NOT %MAT.2.X%==0 ECHO.[12;56H^> %RGB%204;229;255m%MAT.2.NAME:_= %[0m[13;58H%RGB%255;100;100mReq[0m: [1m%MAT.2.X%[0m / %RGB%204;240;229mOwned[0m: [1m%CRAFT.UI.2.OWNED%[0m
IF NOT %MAT.3.X%==0 ECHO.[15;56H^> %RGB%204;229;255m%MAT.3.NAME:_= %[0m[16;58H%RGB%255;100;100mReq[0m: [1m%MAT.3.X%[0m / %RGB%204;240;229mOwned[0m: [1m%CRAFT.UI.3.OWNED%[0m
ECHO.[1m[22;59H%CRAFT.UI.TYPE%[22;87H  !I.%CRAFT.UI_ITEM%.DMG!  [25;58H!I.%CRAFT.UI_ITEM%.DESC_1:_= ![26;58H!I.%CRAFT.UI_ITEM%.DESC_2:_= ![27;58H!I.%CRAFT.UI_ITEM%.DESC_3:_= ![32;58H!I.%CRAFT.UI_ITEM%.HIST_1:_= ![33;58H!I.%CRAFT.UI_ITEM%.HIST_2:_= ![34;58H!I.%CRAFT.UI_ITEM%.HIST_3:_= ![35;58H!I.%CRAFT.UI_ITEM%.HIST_4:_= ![0m
IF %CRAFT.SEL%==3 (ECHO.[%SEL.Y%;37H '---------------'. [1B[20D                  '[1B[19D                    [1B[19D-----------------
) ELSE IF %CRAFT.SEL%==4 (ECHO.[%SEL.Y%;37H '---------------'  [1B[20D                    [1B[20D                    [1B[19D------------------.
) ELSE IF %CRAFT.SEL% GTR 4 (ECHO.[%SEL.Y%;37H '-----------------'[1B[20D                    [1B[20D                    [1B[19D------------------.
) ELSE (ECHO.[%SEL.Y%;37H '---------------'[1B[18D                  [1B[18D                  [1B[17D----------------.)
SET /P "=[3A[13C[1m%CRAFT.UI.CENTER:_= %[0m[u"<NUL
ENDLOCAL

SET /P "=[?25h[2;3H"<NUL
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO CRAFT-SHOP-RE
IF /I %CHOICE.INPUT%==Z (
	SET /A SHOP.TAB=2
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==C (
	SET /A SHOP.TAB=1
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==Q GOTO S-MENU
IF /I %CHOICE.INPUT%==W IF %CRAFT.SEL% GEQ 1 SET /A CRAFT.SEL-=1&GOTO CRAFT-SHOP-RE
IF /I %CHOICE.INPUT%==S IF %CRAFT.SEL% LEQ 7 SET /A CRAFT.SEL+=1&GOTO CRAFT-SHOP-RE
IF /I %CHOICE.INPUT%==R (
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO SHOP
)
IF /I %CHOICE.INPUT%==A (
	SETLOCAL ENABLEDELAYEDEXPANSION
	IF !WEAPONS.REG_LVL.%CRAFT.UI_ITEM%! GEQ 60 (
		ENDLOCAL
		ECHO.[?25l[1;37m[36H
		ECHO.[63C.--------------------------.
		ECHO.[62C ^|  [1m%RGB.FALSE%Upgrade is maxed out! [0m  ^| 
		ECHO.[63C'------------[1mOK[0m------------'
		TIMEOUT /T 2 >NUL
	) ELSE (
		IF %MAT.1.OWNED% GEQ %MAT.1.X% IF %MAT.2.OWNED% GEQ %MAT.2.X% IF %MAT.3.OWNED% GEQ %MAT.3.X% (
			IF NOT %MAT.1.X%==0 CALL "%ITEMS.LOADER%" CRAFT_REM %MAT.1.NAME% %MAT.1.X%
			IF NOT %MAT.2.X%==0 CALL "%ITEMS.LOADER%" CRAFT_REM %MAT.2.NAME% %MAT.2.X%
			IF NOT %MAT.3.X%==0 CALL "%ITEMS.LOADER%" CRAFT_REM %MAT.3.NAME% %MAT.3.X%
			CALL "%ITEMS.LOADER%" REPLACE-MAT %CRAFT.UI_ITEM% 1 WEAPONS
			IF ERRORLEVEL 60 ECHO.%CRAFT.UI_ITEM%$1$0>>"%PLAYERDATA.WEAPONS%"
			
			IF !WEAPONS.REG_LVL.%CRAFT.UI_ITEM%! GEQ 1 (
				ENDLOCAL
				ECHO.[?25l[1;37m[36H
				ECHO.[65C.----------------------.
				ECHO.[64C ^|    [1m%RGB%65;253;254mItem upgraded![0m    ^| 
				ECHO.[65C'----------[1mOK[0m----------'
			) ELSE (
				ENDLOCAL
				ECHO.[?25l[1;37m[36H
				ECHO.[63C.--------------------------.
				ECHO.[62C ^|   [1m%RGB.TRUE%Successfuly crafted![0m   ^| 
				ECHO.[63C'------------[1mOK[0m------------'
			)
			TIMEOUT /T 3 >NUL
			GOTO CRAFT-SHOP
		)
		ENDLOCAL
		ECHO.[?25l[1;37m[36H
		ECHO.[63C.--------------------------.
		ECHO.[62C ^|  [1m%RGB.FALSE%You cannot craft this![0m  ^| 
		ECHO.[63C'------------[1mOK[0m------------'
		TIMEOUT /T 2 >NUL
	)
)
IF /I %CHOICE.INPUT%.==. START "" "https://github.com/136MasterNR/Battles-of-Batch#shop-64"
GOTO CRAFT-SHOP-RE

:QUESTS
CALL "%QUEST.LOADER%" LOAD
TITLE %TITLE%Quests
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Quests;LargeImage=preview_quests;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
CALL "%DATA_SAVES%\QUESTS.cmd"
IF A==A (
ECHO.[?25l[H[0m.--------------------------------------------------.-------------.--------------------------------------------------.
ECHO.^|                                                  ^| SIDE QUESTS ^|                                                  ^|
ECHO.'--------------------------------------------------'------.------'--------------------------------------------------'
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          ^|                                                          
ECHO.                                                          '                                                          
ECHO.                                      [1;37mComplete all quests to unlock new quests![0m                                      
ECHO..---------------------------------------------------------.---------------------------------------------------------.[H
)
CALL "%QUEST.LOADER%" NUL
PAUSE>NUL
GOTO S-MENU
:SETTINGS
CHCP 65001>NUL
TITLE %TITLE%Settings
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=nul;Details=Settings;LargeImage=preview_settings;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
(
CLS
ECHO.[?25l[H[0m                                                [4m                    [0m                                                 
ECHO. ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï•‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï•‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[4m‚î¨‚ïØ     SETTINGS     ‚ï∞‚î¨[0m‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ 
ECHO. ‚îÇ     %RGB%237;244;255mSetting Name[0m     ‚ïë    %RGB%237;244;255mStatus[0m    ‚ïë                                %RGB%237;244;255mDescription[0m                                ‚îÇ 
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ     %RGB%187;203;250mMusic ^& SFX[0m      ‚ïë   [s           ‚ïë    %RGB%194;255;255mTurn ON or OFF the Music and the SFX. %RGB.CYAN%Use "audio" to toggle.[0m           ‚îÇ 
IF "%DENIED_AUDIO%"=="TRUE" ( ECHO.[u%RGB%195;1;1mŒß LOCKED[0m[8CYour device does not meet the requirements for this feature.) ELSE IF "%AUDIO.VALUE%"=="TRUE" ( ECHO.[u%RGB.TRUE%‚àö %AUDIO.VALUE%[0m ) ELSE ( ECHO.[u%RGB.FALSE%Œß %AUDIO.VALUE%[0m )
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ     %RGB%187;203;250mMusic Volume[0m     ‚ïë   [s           ‚ïë    %RGB%194;255;255mAdjust the Music volume. %RGB.CYAN%Use "music (number)" %RGB.GRAY%Example: "Music 50"[0m      ‚îÇ [86D%RGB%196;255;225m%VOLUME%[0m
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ      %RGB%187;203;250mSFX Volume[0m      ‚ïë   [s           ‚ïë    %RGB%194;255;255mAdjust the SFX volume. %RGB.CYAN%Use "sfx (number)"[0m                              ‚îÇ [86D%RGB%196;255;225m%SFX.VOLUME%[0m
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ      %RGB%187;203;250mAuto Save[0m       ‚ïë   %RGB%163;255;177m‚àö TRUE[0m     ‚ïë    %RGB%255;89;89mFeature unavailable.[0m                                                   ‚îÇ 
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ       %RGB%187;203;250mUpdater[0m        ‚ïë   [s           ‚ïë    %RGB%194;255;255mCheck for updates on startup. %RGB.CYAN%Use "updates" to toggle.[0m                 ‚îÇ 
IF "%UPDATE.VALUE%"=="TRUE" ( ECHO.[u%RGB%163;255;177m‚àö %UPDATE.VALUE%[0m ) ELSE ( ECHO.[u%RGB%255;89;89mŒß %UPDATE.VALUE%[0m )
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ      %RGB%187;203;250mShow Intro[0m      ‚ïë   [s           ‚ïë    %RGB%194;255;255mWhether to show the HTS intro on startup. %RGB.CYAN%Use "intro" to toggle.[0m       ‚îÇ 
IF "%SHOW.INTRO%"=="TRUE" ( ECHO.[u%RGB%163;255;177m‚àö %SHOW.INTRO%[0m ) ELSE ( ECHO.[u%RGB%255;89;89mŒß %SHOW.INTRO%[0m )
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ    %RGB%187;203;250mRich Presence[0m     ‚ïë   [s           ‚ïë    %RGB%194;255;255mShow rich presence for discord. %RGB.CYAN%Use "rp" to toggle.[0m                    ‚îÇ 
IF "%RICHPRESENCE.VALUE%"=="TRUE" ( ECHO.[u%RGB%163;255;177m‚àö %RICHPRESENCE.VALUE%[0m ) ELSE ( ECHO.[u%RGB%255;89;89mŒß %RICHPRESENCE.VALUE%[0m )
ECHO. ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï° 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ                                                                                                                 ‚îÇ 
ECHO. ‚îÇ ‚ñ∫ Type back to return to the menu.                                                                              ‚îÇ 
ECHO.‚ï≠‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚ïÆ
ECHO.‚îÇ                                                                                                                   ‚îÇ
ECHO.‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ[2A
)
SET UDERFINE=
SET "INPUT_PART=options"
SETLOCAL ENABLEDELAYEDEXPANSION
%INPUT% "PROMPT=[0m‚îÇ [0;36mType[0m: [1;37m[s[?25h" "length=107"
ENDLOCAL&SET UDERFINE=%UDERFINE%
ENDLOCAL
SET "INPUT_PART=nul"
 IF NOT DEFINED UDERFINE GOTO SETTINGS
  IF /I "%UDERFINE%"=="BACK" GOTO S-MENU
   IF /I "%UDERFINE%"=="EXIT" GOTO S-MENU
    IF /I "%UDERFINE%"=="GO BACK" GOTO S-MENU
     IF /I "%UDERFINE%"=="MENU" GOTO S-MENU
	  IF /I "%UDERFINE%"=="RETURN" GOTO S-MENU
	   IF /I "%UDERFINE%"=="Q" GOTO S-MENU
 IF /I "%UDERFINE%"=="REFRESH" (MODE CON:COLS=%COLS% LINES=%LINES%&GOTO SETTINGS)
 IF /I "%UDERFINE%"=="SOUND" CALL "%SETTING%" AUDIO
  IF /I "%UDERFINE%"=="MUSIC" CALL "%SETTING%" AUDIO
   IF /I "%UDERFINE%"=="AUDIO" CALL "%SETTING%" AUDIO
 IF /I "%UDERFINE%"=="KEYS" CALL "%SETTING%" SET %SHORTCUTS.VALUE% 6 SHORTCUTS.VALUE
  IF /I "%UDERFINE%"=="SHORTCUT" CALL "%SETTING%" SET %SHORTCUTS.VALUE% 6 SHORTCUTS.VALUE
   IF /I "%UDERFINE%"=="SHORTCUT KEYS" CALL "%SETTING%" SET %SHORTCUTS.VALUE% 6 SHORTCUTS.VALUE
 IF /I "%UDERFINE:~0,6%"=="VOLUME" CALL "%SETTING%" VOLUME
  IF /I "%UDERFINE:~0,6%"=="MUSIC " CALL "%SETTING%" VOLUME
   IF /I "%UDERFINE:~0,6%"=="AUDIO " CALL "%SETTING%" VOLUME
    IF /I "%UDERFINE:~0,6%"=="SOUND " CALL "%SETTING%" VOLUME
 IF /I "%UDERFINE:~0,3%"=="SFX" CALL "%SETTING%" VOLUME
 IF /I "%UDERFINE%"=="UPDATE" CALL "%SETTING%" SET %UPDATE.VALUE% 5 UPDATE.VALUE
  IF /I "%UDERFINE%"=="UPDATES" CALL "%SETTING%" SET %UPDATE.VALUE% 5 UPDATE.VALUE
   IF /I "%UDERFINE%"=="UPDATER" CALL "%SETTING%" SET %UPDATE.VALUE% 5 UPDATE.VALUE
 IF /I "%UDERFINE%"=="INTRO" CALL "%SETTING%" SET %SHOW.INTRO% 6 SHOW.INTRO
  IF /I "%UDERFINE%"=="SHOW" CALL "%SETTING%" SET %SHOW.INTRO% 6 SHOW.INTRO
   IF /I "%UDERFINE%"=="SHOW INTRO" CALL "%SETTING%" SET %SHOW.INTRO% 6 SHOW.INTRO
 IF /I "%UDERFINE%"=="RP" CALL "%SETTING%" SET %RICHPRESENCE.VALUE% 7 RICHPRESENCE.VALUE
  IF /I "%UDERFINE%"=="PRESENCE" CALL "%SETTING%" SET %RICHPRESENCE.VALUE% 7 RICHPRESENCE.VALUE
   IF /I "%UDERFINE%"=="RICH PRESENCE" CALL "%SETTING%" SET %RICHPRESENCE.VALUE% 7 RICHPRESENCE.VALUE
    IF /I "%UDERFINE%"=="RPC" CALL "%SETTING%" SET %RICHPRESENCE.VALUE% 7 RICHPRESENCE.VALUE
	 IF /I "%UDERFINE%"=="RICH" CALL "%SETTING%" SET %RICHPRESENCE.VALUE% 7 RICHPRESENCE.VALUE
 IF "%UDERFINE%"=="IAMADEVELOPER" (
	IF %terminal% EQU 0 (
		START /WAIT "" "%CD%\data\cmd\TerminalGuidelines.txt"
		CALL "%SAVE%" "FILE=%MAIN_GAME%\main.config" 5 terminal=1
		SET terminal=1
	)
	CALL :TERMINAL
 )
GOTO SETTINGS
:RESET
TASKKILL /F /FI "WINDOWTITLE eq wscript.exe" /T>NUL 2>NUL
RD /S /Q "%MAIN_GAME%"
GOTO RESTART
:LICENSE
CLS
TYPE Copyright.txt
PAUSE>NUL
GOTO S-MENU
:PRE_LOAD
IF NOT EXIST "%LOAD.LEVEL_%%SELECTED%\setup.cmd" GOTO MAP
ECHO.[2J[21;42H“â  Preparing Your Amazing Battle[17D[1B[s
ECHO.[u  0%%
TITLE %TITLE%Loading Battle ...
IF %RICHPRESENCE.VALUE%==TRUE START /MIN "RichManager" "%RichManager%" State=Level %SELECTED% - Chapter %CHAPTER%;Details=Currently in battle;LargeImage=preview_battle;LargeImageTooltip=;SmallImage=icon;SmallImageTooltip=Battles of Batch
IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 (
	CALL "%AUDIOMANAGER%" STOP menu
	IF %SELECTED% EQU 7 (
		CALL "%AUDIOMANAGER%" START game\battle\dangerousplains.mp3 battle True %VOLUME%
	) ELSE CALL "%AUDIOMANAGER%" START game\battle\winternight.mp3 battle True %VOLUME%
)
CALL "%SCRIPTS_GAME%\loader.cmd" || (
	ECHO.[u[1A[10D[2K%RGB.RED%Failed to load the battle!
	PAUSE>NUL
	GOTO S-MENU
)
IF DEFINED LOAD.ERR GOTO MENU
ECHO.[u 98%%
SETLOCAL ENABLEDELAYEDEXPANSION
TITLE %TITLE%!MAP.NAME.%SELECTED%:_= ! ^(#%SELECTED%^)
ENDLOCAL
ECHO.[u100%%
CLS
:IN-BATTLE
IF EXIST LET.DEBUG (
	CALL "%DEBUG.GAMELOADER%\1"
	GOTO :REFRESH-BATTLE
)
(
ECHO.[?25l[H.--------------------.----------------------------------------------------------------------------------------------.
ECHO.^| Press %RGB.PINK%Q[0m to retreat ^|[103C^|
ECHO.^|--------------------'[95C^|
FOR /L %%I IN (1, 1, 44) DO ECHO.^|[115C^|
ECHO.'-------------------------------------------------------------------------------------------------------------------'[2A
ECHO.%LOC.HP.P%
ECHO.[2C     ___             
ECHO.[2C    //_\\_          
ECHO.[2C  ."\\    ".        
ECHO.[2C /          \       
ECHO.[2C ^|           \_     
ECHO.[2C ^|       ,--.-.^)    
ECHO.[2C  \     /  o \o\    
ECHO.[2C  /\/\  \    /_/    
ECHO.[2C   (_.   `--'__^)    
ECHO.[2C    ^|     .-'  \    
ECHO.[2C    ^|  .-'.     ^)   
ECHO.[2C    ^| (  _/--.-'    
ECHO.[2C    ^|  `.___.'      
ECHO.[2C    ^|               
)
:REFRESH-BATTLE
:: Calculate the HP of all enemies together
SET ENEMY.HP.NOW.T=
FOR /L %%I IN (1,1,%EN.MAX%) DO (
	SET /A ENEMY.HP.NOW.T+=ENEMY.HP.NOW.%%I
)

:: Display the HP bars
CALL "%SCRIPTS_GAME%\hpbar_now.cmd"

:: Display HP and last action information
ECHO.[47;3H^|                                                                                                                 ^|[47;3H[1mYour HP: %RGB.GREEN%%PLAYER.HP.NOW%[0m%RGB.GRAY%/%PLAYER.HP.FULL%[0m [47;40HYou dealt %PLAYER.ATTACK.AMOUNT% DMG to %PLAYER.ATTACK.ENEMY% - CRIT: %ATK.CRIT%[47;90HEnemy Total HP: %ENEMY.HP.NOW.T%/%ENEMY.HP.FULL.T%

:: Display death animation if needed
CALL "%SCRIPTS_GAME%\fade.cmd"

:: If all enemies are dead, win
IF %ENEMY.HP.NOW.T% LEQ 0 (
	CALL "%SCRIPTS_POP%\win.cmd"
	IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 (
		CALL "%AUDIOMANAGER%" STOP battle
		CALL "%AUDIOMANAGER%" START system\villageambiance.mp3 menu True %VOLUME%
	)
	GOTO MAP
)

:: If the player is dead, lose
IF %PLAYER.HP.NOW% LEQ 0 (
	CALL "%SCRIPTS_POP%\lose.cmd"
	IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 (
		CALL "%AUDIOMANAGER%" STOP battle
		CALL "%AUDIOMANAGER%" START system\villageambiance.mp3 menu True %VOLUME%
	)
	GOTO MAP
)

:TURN
CALL "%SCRIPTS_GAME%\turn.cmd" ACT

IF %AV.PLAYER%==0 (ECHO.[46;3H[1mYour AV: %RGB.PURPLE%%AV.PLAYER%[0m ^(Your Turn^)   ) ELSE ECHO.[46;3H[1mYour AV: %RGB.PURPLE%%AV.PLAYER%[0m               

IF NOT %CURR_TURN%==AV.PLAYER (
	CALL "%ACT.ENEMY%" %CURR_TURN%
	GOTO IN-BATTLE
)

::Visuals
:BATTLE-CHOICE
CALL "%SCRIPTS_GAME%\logger.cmd" DISPLAY
CALL "%SCRIPTS_GAME%\visual.cmd"

IF "%INV.SEL_NAME%"=="EMPTY" (
	ECHO.[42;4H[s                                                          
	ECHO.[u[1B:----------------------------------------------:      
	ECHO.[u[2B  %RGB.BROWN%No item selected[0m, press %RGB.CYAN%E[0m to choose an item. 
	ECHO.[u[3B:----------------------------------------------:      
) ELSE IF NOT DEFINED INV.SEL_NAME (
	ECHO.[42;4H[s                                                          
	ECHO.[u[1B:---------------------------------------------:      
	ECHO.[u[2B  %RGB.BROWN%To use an item[0m, first press %RGB.CYAN%E[0m to select it.
	ECHO.[u[3B:---------------------------------------------:      
) ELSE (
	ECHO.[42;4H[s:---------------------------------------------------:
	SETLOCAL ENABLEDELAYEDEXPANSION
	IF "%INV.SEL_NAME%"=="ATTACK" (
		IF !WEAPONS.REG_NAME.%WIELDING.WEAPON%![==[ (
			ECHO.[u[1B  [1mPress %RGB.CYAN%A[0m[1m to strike the enemy using your %RGB.COIN%fists[0m[1m. 
		) ELSE (
			ECHO.[u[1B  [1mPress %RGB.CYAN%A[0m[1m to strike the enemy using %RGB.COIN%!WEAPONS.REG_NAME.%WIELDING.WEAPON%:_= ![0m[1m.                          
		)
	) ELSE ECHO.[u[1B  [1mPress %RGB.CYAN%A[0m[1m to use %RGB.COIN%%INV.SEL_NAME%[0m[1m on the chosen enemy.                          
	ENDLOCAL
	ECHO.[u[2B  [0mPress %RGB.CYAN%E[0m to change the selected action.      
	ECHO.[u[3B:---------------------------------------------------:       
)

SETLOCAL ENABLEDELAYEDEXPANSION
IF !ENEMY.HP.NOW.%INPUTATK%! EQU 0 (
	ENDLOCAL
	CALL "%SCRIPTS_GAME%\rand_enemy.cmd"
) ELSE ENDLOCAL

::Select Action
:BATTLE-SEL_CHOICE
CALL :BATTLE-DISPLAY_CHOICE
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO BATTLE-SEL_CHOICE
IF /I %CHOICE.INPUT%==Q (
	IF %AUDIO.VALUE%==TRUE IF %VOLUME% NEQ 0 (
		CALL "%AUDIOMANAGER%" STOP battle
		CALL "%AUDIOMANAGER%" START system\villageambiance.mp3 menu True %VOLUME%
	)
	GOTO MAP
)
IF /I %CHOICE.INPUT%==S (
	CALL :BATTLE-S_CHOICE
	CALL :BATTLE-DISPLAY_CHOICE
)
IF /I %CHOICE.INPUT%==W (
	CALL :BATTLE-W_CHOICE
	CALL :BATTLE-DISPLAY_CHOICE
)

IF /I %CHOICE.INPUT%==Z IF "%SEL.CHARACTER%"=="SIMPSONS" (
	CALL :CLEAR_INFO_SELECTION
	CALL "%CMD.CLEARVAR%"
	CALL "%ACT.SIMPSONS.LASER%" || CALL :ERROR ERRLINE ID01.inGameLASER    -0
	%ADD-CMD%
	GOTO REFRESH-BATTLE
)
IF /I %CHOICE.INPUT%== START "" "https://github.com/136MasterNR/Battles-of-Batch#battle-62"

IF /I %CHOICE.INPUT%==A (
	CALL :CLEAR_INFO_SELECTION
	IF NOT DEFINED INV.SEL_NAME (
		ECHO.[41;14H%RGB.RED%[4mYou haven't selected an action![0m
		PAUSE>NUL
		ECHO.[41;14H                               
	) ELSE IF "%INV.SEL_NAME%"=="EMPTY" (
		ECHO.[41;14H%RGB.RED%[4mYou haven't selected an action![0m
		PAUSE>NUL
		ECHO.[41;14H                               
	) ELSE (
		CALL "%CMD.CLEARVAR%"
		CALL "%SCRIPTS.ACT%\act.cmd" %INV.SEL_NAME% || CALL :ERROR ERRLINE ID01.inBattleACT.A    -0
		GOTO REFRESH-BATTLE
	)
)
IF /I %CHOICE.INPUT%==E (
	CALL :CLEAR_INFO_SELECTION
	GOTO BATTLE-INVENTORY
)

IF /I %CHOICE.INPUT%==N (
	CALL :CLEAR_INFO_SELECTION
	CALL "%CMD.CLEARVAR%"
	CALL "%SCRIPTS.ACT%\act.cmd" NOTHING
	GOTO REFRESH-BATTLE
)

IF /I %CHOICE.INPUT%==R (
	CALL :CLEAR_INFO_SELECTION
	MODE CON:COLS=%COLS% LINES=%LINES%
	GOTO IN-BATTLE
)

IF /I %CHOICE.INPUT%== (
	GOTO PRE_LOAD
)

IF /I %CHOICE.INPUT%== IF %terminal% EQU 1 (
	CALL :TERMINAL
	GOTO IN-BATTLE
)

IF /I %CHOICE.INPUT%.==. IF %terminal% EQU 1 (
	CALL ".\data\cmd\LevelEditor.cmd" OUT
	CLS
	GOTO PRE_LOAD
)

GOTO BATTLE-SEL_CHOICE
:CLEAR_INFO_SELECTION
:: Clears the info that appear on the right side when focusing on an enemy.
ECHO.%TMP.LOC_HP_OLD%[4B[2D   [1B[3D   %TMP.LOC_HP_OLD%[11C[5B             %TMP.LOC_HP_OLD%[11C[4B             %TMP.LOC_HP_OLD%[11C[3B             [0m%TMP.LOC_HP_OLD%[11C[2B             
EXIT /B 0
:BATTLE-INVENTORY
COLOR 08
CALL "%ITEMS.LOADER%" LIST_EQ
:BATTLE-INVENTORY_RE
CALL "%IG.CMDS%" INVENTORY
%CHOICE%
IF %CHOICE.INPUT%.==. GOTO BATTLE-INVENTORY_END
IF /I %CHOICE.INPUT%==S (
	IF %INV.SEL% LSS %ITEM.EQ_CNT% (SET /A INV.SEL+=1) ELSE SET /A INV.SEL=0
	GOTO BATTLE-INVENTORY_RE
)
IF /I %CHOICE.INPUT%==W (
	IF %INV.SEL% LEQ 0 (SET /A INV.SEL=%ITEM.EQ_CNT%) ELSE SET /A INV.SEL-=1
	GOTO BATTLE-INVENTORY_RE
)
:BATTLE-INVENTORY_END
SET "TMP.SPACES=                        "
ECHO.[u%TMP.SPACES%[u[1B%TMP.SPACES%[u[2B%TMP.SPACES%[u[3B%TMP.SPACES%[u[4B%TMP.SPACES%[u[5B%TMP.SPACES%[u[6B%TMP.SPACES%[u[7B%TMP.SPACES%[u[8B%TMP.SPACES%[u[9B%TMP.SPACES%[u[10B%TMP.SPACES%[u[11B%TMP.SPACES%[u[12B%TMP.SPACES%[u[13B%TMP.SPACES%[u[14B%TMP.SPACES%[u[15B%TMP.SPACES%[u[17B%TMP.SPACES%   [u[18B%TMP.SPACES%    
GOTO IN-BATTLE

:BATTLE-S_CHOICE
SETLOCAL ENABLEDELAYEDEXPANSION
IF %INPUTATK% GTR %EN.MAX% (SET INPUTATK=1) ELSE SET /A INPUTATK+=1
:BATTLE-S_CHOICE-RE
IF !ENEMY.HP.NOW.%INPUTATK%! EQU 0 IF %INPUTATK% GTR %EN.MAX% (SET INPUTATK=1) ELSE (
	SET /A INPUTATK+=1
	GOTO BATTLE-S_CHOICE-RE
)
IF !ENEMY.HP.NOW.%INPUTATK%! EQU 0 GOTO :BATTLE-S_CHOICE-RE
ENDLOCAL&&SET INPUTATK=%INPUTATK%
EXIT /B 0
:BATTLE-W_CHOICE
SETLOCAL ENABLEDELAYEDEXPANSION
IF %INPUTATK% LSS 1 (SET INPUTATK=%EN.MAX%) ELSE SET /A INPUTATK-=1
:BATTLE-W_CHOICE-RE
IF !ENEMY.HP.NOW.%INPUTATK%! EQU 0 IF %INPUTATK% LSS 1 (
	SET INPUTATK=%EN.MAX%
) ELSE (
	SET /A INPUTATK-=1
	GOTO BATTLE-W_CHOICE-RE
)
IF !ENEMY.HP.NOW.%INPUTATK%! EQU 0 GOTO :BATTLE-W_CHOICE-RE
ENDLOCAL&&SET INPUTATK=%INPUTATK%
EXIT /B 0
:BATTLE-DISPLAY_CHOICE
SETLOCAL ENABLEDELAYEDEXPANSION
IF DEFINED TMP.LOC_HP_OLD (
	:: Clears the info that appear on the right side when focusing on an enemy.
	ECHO.%TMP.LOC_HP_OLD%[4B[2D   [1B[3D   %TMP.LOC_HP_OLD%[11C[5B             %TMP.LOC_HP_OLD%[11C[4B             %TMP.LOC_HP_OLD%[11C[3B             [0m%TMP.LOC_HP_OLD%[11C[2B             
)
SET TMP.LOC_HP_OLD=!LOC.HP.%INPUTATK%!
FOR /F "TOKENS=1-2 DELIMS=," %%A IN ("!ENEMY.ATK.AMOUNT.%INPUTATK%!") DO (
	SET /A "ENEMY.MAXP_ATK=%%A+%%B"
	SET /A "ENEMY.MINP_ATK=%%B"
)
ECHO.!LOC.HP.%INPUTATK%![4B[2D[4m^|[0m [0m^>[1B[3D' ^>!LOC.HP.%INPUTATK%![11C[5B%RGB.PURPLE%AV:[0m !AV.%INPUTATK%!!LOC.HP.%INPUTATK%![11C[4B%RGB%245;151;151mAtk: [0m!ENEMY.MINP_ATK!~!ENEMY.MAXP_ATK!!LOC.HP.%INPUTATK%![11C[3B%RGB%176;225;187mHP: [0m!ENEMY.HP.NOW.%INPUTATK%!!LOC.HP.%INPUTATK%![11C[2B%RGB.CYAN%Lvl: [0m!ENEMY.LVL.%INPUTATK%!
ENDLOCAL&&SET TMP.LOC_HP_OLD=%TMP.LOC_HP_OLD%
EXIT /B 0
:ERROR <resultVar> <uniqueID> [LineOffset]
IF "%IGNORE_ERRORS%"=="TRUE" EXIT /B 0
IF DEFINED VERCODE (
	IF NOT DEFINED AUDIO.VALUE CALL :SETT_ERR
	IF NOT DEFINED VOLUME CALL :SETT_ERR
	IF NOT DEFINED SFX.VOLUME CALL :SETT_ERR
	IF NOT DEFINED AUTOSAVE.VALUE CALL :SETT_ERR
	IF NOT DEFINED UPDATE.VALUE CALL :SETT_ERR
	IF NOT DEFINED SHOW.INTRO CALL :SETT_ERR
)
SET "ERR.CODE=%ERRORLEVEL%"
CLS
COLOR 0C
TITLE CRASH
SETLOCAL
FOR /F "USEBACKQ TOKENS=1 DELIMS=:" %%L IN (`FINDSTR /N "%~2" "%~f0"`) DO set /a LINENR=%~3 + %%L
SET "INF_ERR=%~2"
( 
	ENDLOCAL
	SET "%~1=%LINENR%"
	ECHO.There was a fatal error while running.
	ECHO.
	ECHO.Please contact the developers and send this:
	ECHO.- Error Information -
	ECHO. Err Code: '%ERR.CODE%'
	ECHO. Err Info: '%INF_ERR:~0,2%:%INF_ERR:~2%'
	SETLOCAL ENABLEDELAYEDEXPANSION
	ECHO. Position: '!%~1!'
	ENDLOCAL
	ECHO.
	ECHO.
	ECHO.[1;33mPlease do not contact the developers unless you have NOT touched anything in the files.
	ECHO.In that matter, you should download and extract the game again.
	ECHO.
	ECHO.[0;37mPress any key to verify file indetity ...
	PAUSE>NUL
	CALL :VERIFY-FILE-IDENTITY
	EXIT 1
)
EXIT 1
:SETT_ERR
CLS
ECHO.[!] Fixing settings...
IF NOT DEFINED AUDIO.VALUE SET AUDIO.VALUE=TRUE
IF NOT DEFINED VOLUME SET VOLUME=90
IF NOT DEFINED SFX.VOLUME SET SFX.VOLUME=90
IF NOT DEFINED AUTOSAVE.VALUE SET AUTOSAVE.VALUE=TRUE
IF NOT DEFINED UPDATE.VALUE SET UPDATE.VALUE=TRUE
IF NOT DEFINED SHOW.INTRO SET SHOW.INTRO=TRUE
IF NOT DEFINED RICHPRESENCE.VALUE SET RICHPRESENCE.VALUE=TRUE
(
	ECHO.SET AUDIO.VALUE=%AUDIO.VALUE%
	ECHO.SET VOLUME=%VOLUME%
	ECHO.SET SFX.VOLUME=%SFX.VOLUME%
	ECHO.SET AUTOSAVE.VALUE=%AUTOSAVE.VALUE%
	ECHO.SET UPDATE.VALUE=%UPDATE.VALUE%
	ECHO.SET SHOW.INTRO=%SHOW.INTRO%
	ECHO.SET RICHPRESENCE.VALUE=%RICHPRESENCE.VALUE%
	ECHO.EXIT /B 0
)>%SETTINGS.LOAD%
GOTO RESTART
:VERIFY-FILE-IDENTITY
CLS
ECHO.Preparing file identity verification...
SET /A NEW.CNT=0
SET /A DIF.CNT=0
SET /A DUP.CNT=0
SET /A MIS.CNT=0
SET "UPDATE.LOC=%DATA_TMP%\update.cmd"
SET "UPDZIP.LOC=%tmp%\update.zip"
SET "EXTRAC.LOC=%TMP%\bob"
BREAK>".\data\logs\verify-file-identity.log"
CURL -S "https://136masternr.github.io/HTS-Studios/get-update/battlesofbatch.bat" --SSL-NO-REVOKE >"./data/temp/update.cmd"
>NUL FIND /I "SET UPDATE.VER=" ".\data\temp\update.cmd" && (
	CALL "%UPDATE.LOC%"
	DEL /Q "%UPDATE.LOC%"
)||(
	FOR %%R IN ("%UPDATE.LOC%") DO IF %%~zR LSS 1 ( ECHO.VERIFIER: Failed to download latest update because the information was not found.
	) ELSE ( ECHO.VERIFIER: Failed to download latest update because the information was not recognized. )
	SET OUTOFDATE=UNRE
	IF EXIST "%UPDATE.LOC%" DEL /Q "%UPDATE.LOC%"
	EXIT /B 0
)
CURL -S "%UPDATE.URL%" --SSL-NO-REVOKE >"%UPDZIP.LOC%"
CALL :UNZIPFILE "%EXTRAC.LOC%" "%UPDZIP.LOC%"
SETLOCAL ENABLEDELAYEDEXPANSION

SET "Folder1=%CD%"
SET "Folder2=%EXTRAC.LOC%"

FOR /R "%Folder1%" %%x In (*.*) Do (
	SET /A TOTALFOUNDFILES+=1
    SET "FullPath=%%x"
    SET "RelPath=!FullPath:%Folder1%=!"

    IF EXIST "%Folder2%!RelPath!" (
      >NUL 2>&1 FC /b "%Folder1%!RelPath!" "%Folder2%!RelPath!" && (
       ECHO.Verified - %%x >>".\data\logs\verify-file-identity.log"
	   SET /A DUP.CNT+=1
      )||(
       ECHO.Corrupt  - %%x >>".\data\logs\verify-file-identity.log"
	   SET /A DIF.CNT+=1
      )
    ) ELSE (
      ECHO.New File - %%x >>".\data\logs\verify-file-identity.log"
	  SET /A NEW.CNT+=1
    )
)

FOR /R "%Folder2%" %%x IN (*.*) DO (

    SET "FullPath=%%x"
    SET "RelPath=!FullPath:%Folder2%=!"

    IF NOT EXIST "%Folder1%!RelPath!" (
      ECHO.Missing - %Folder1%!RelPath! >>".\data\logs\verify-file-identity.log"
	  SET /A MIS.CNT+=1
    )
)
RD /S /Q "%EXTRAC.LOC%"

ECHO.Found %NEW.CNT% new files.
ECHO.Found %DIF.CNT% corrupt files.
ECHO.Found %MIS.CNT% missing files.
ECHO.Found %DUP.CNT% verified files.
START "" ".\data\logs\verify-file-identity.log"
ECHO.
ECHO.
ENDLOCAL
ECHO.Press any key to exit.
PAUSE>NUL
EXIT /B 0
:UNZIPFILE
SET VBS="%TMP%\_.VBS"
IF EXIST "%VBS%" DEL /F /Q "%VBS%"
>%VBS% ECHO Set fso = CreateObject("Scripting.FileSystemObject")
>>%VBS% ECHO If NOT fso.FolderExists(%1) Then
>>%VBS% ECHO fso.CreateFolder(%1)
>>%VBS% ECHO End If
>>%VBS% ECHO set objShell = CreateObject("Shell.Application")
>>%VBS% ECHO set FilesInZip=objShell.NameSpace(%2).items
>>%VBS% ECHO objShell.NameSpace(%1).CopyHere(FilesInZip)
>>%VBS% ECHO Set fso = Nothing
>>%VBS% ECHO Set objShell = Nothing
CSCRIPT //NOLOGO "%VBS%"

:ResetPlayerData
(
ECHO.SET PLAYER.MONEY=0
ECHO.SET PLAYER.XP=0
ECHO.SET PLAYER.LVL=0
ECHO.SET PLAYER.MAP.LEVEL=1
ECHO.SET PLAYER.XP.REQ=%PLAYER.XP.REQ%
ECHO.SET COMPLETED.MAPS=0
ECHO.EXIT /B 0
)>"%DATA_SAVES%\PLAYERDATA.cmd"
CALL "%DATA_SAVES%\PLAYERDATA.cmd"
EXIT /B 0

:ResetSkills
SET SKILL.ATK=1
SET SKILL.CRIT_RATE=1
SET SKILL.HP=1
SET SKILL.STO=1
(
	ECHO.SET SKILL.ATK=%SKILL.ATK%
	ECHO.SET SKILL.CRIT_RATE=%SKILL.CRIT_RATE%
	ECHO.SET SKILL.HP=%SKILL.HP%
	ECHO.SET SKILL.STO=%SKILL.STO%
	ECHO.EXIT /B 0
)>"%PLAYERSKILLS.LOAD%"
CALL "%PLAYERSKILLS.LOAD%"
EXIT /B 0

:EOF
EXIT /B 0
